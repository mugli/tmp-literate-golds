<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Source: writer.go in package cloud.google.com/go/storage</title>
<link href="../../../../css/lightLiterate-v0.3.2-preview.css" rel="stylesheet">
<script src="../../../../jvs/golds-v0.3.2-preview.js"></script>
<body onload="onPageLoad()"><div>

<pre id="header"><code><span class="title">Source File</span>
	writer.go

<span class="title">Belonging Package</span>
	<a href="../../../../pkg/cloud.google.com/go/storage.html">cloud.google.com/go/storage</a>
</code></pre>
<style>input[type=radio] {display: none;}
input[id=r0]:checked ~pre label[for=r0],
input[id=r1]:checked ~pre label[for=r1],
input[id=r2]:checked ~pre label[for=r2],
input[id=r3]:checked ~pre label[for=r3],
input[id=r4]:checked ~pre label[for=r4],
input[id=r5]:checked ~pre label[for=r5],
input[id=r6]:checked ~pre label[for=r6],
input[id=r7]:checked ~pre label[for=r7],
input[id=r8]:checked ~pre label[for=r8],
input[id=r9]:checked ~pre label[for=r9],
input[id=r10]:checked ~pre label[for=r10],
input[id=r11]:checked ~pre label[for=r11],
input[id=r12]:checked ~pre label[for=r12],
input[id=r13]:checked ~pre label[for=r13],
input[id=r14]:checked ~pre label[for=r14],
input[id=r15]:checked ~pre label[for=r15],
input[id=r16]:checked ~pre label[for=r16],
input[id=r17]:checked ~pre label[for=r17],
input[id=r18]:checked ~pre label[for=r18],
input[id=r19]:checked ~pre label[for=r19],
input[id=r20]:checked ~pre label[for=r20],
input[id=r21]:checked ~pre label[for=r21],
input[id=r22]:checked ~pre label[for=r22],
input[id=r23]:checked ~pre label[for=r23],
input[id=r24]:checked ~pre label[for=r24],
input[id=r25]:checked ~pre label[for=r25],
input[id=r26]:checked ~pre label[for=r26],
input[id=r27]:checked ~pre label[for=r27],
input[id=r28]:checked ~pre label[for=r28],
input[id=r29]:checked ~pre label[for=r29],
input[id=r30]:checked ~pre label[for=r30],
input[id=r31]:checked ~pre label[for=r31],
input[id=r32]:checked ~pre label[for=r32],
input[id=r33]:checked ~pre label[for=r33]
{background: #226; color: #ff8;}
input[id=i0]:checked ~pre .i0,
input[id=i1]:checked ~pre .i1,
input[id=i2]:checked ~pre .i2,
input[id=i3]:checked ~pre .i3,
input[id=i4]:checked ~pre .i4,
input[id=i5]:checked ~pre .i5,
input[id=i6]:checked ~pre .i6,
input[id=i7]:checked ~pre .i7,
input[id=i8]:checked ~pre .i8
{background: brown; color: #eed;}
</style><input id="r0" type="radio" name="g"/>
<input id="r1" type="radio" name="g"/>
<input id="r2" type="radio" name="g"/>
<input id="r3" type="radio" name="g"/>
<input id="r4" type="radio" name="g"/>
<input id="r5" type="radio" name="g"/>
<input id="r6" type="radio" name="g"/>
<input id="r7" type="radio" name="g"/>
<input id="r8" type="radio" name="g"/>
<input id="r9" type="radio" name="g"/>
<input id="r10" type="radio" name="g"/>
<input id="r11" type="radio" name="g"/>
<input id="r12" type="radio" name="g"/>
<input id="r13" type="radio" name="g"/>
<input id="r14" type="radio" name="g"/>
<input id="r15" type="radio" name="g"/>
<input id="r16" type="radio" name="g"/>
<input id="r17" type="radio" name="g"/>
<input id="r18" type="radio" name="g"/>
<input id="r19" type="radio" name="g"/>
<input id="r20" type="radio" name="g"/>
<input id="r21" type="radio" name="g"/>
<input id="r22" type="radio" name="g"/>
<input id="r23" type="radio" name="g"/>
<input id="r24" type="radio" name="g"/>
<input id="r25" type="radio" name="g"/>
<input id="r26" type="radio" name="g"/>
<input id="r27" type="radio" name="g"/>
<input id="r28" type="radio" name="g"/>
<input id="r29" type="radio" name="g"/>
<input id="r30" type="radio" name="g"/>
<input id="r31" type="radio" name="g"/>
<input id="r32" type="radio" name="g"/>
<input id="r33" type="radio" name="g"/>
<input id="i0" type="radio" name="i"/>
<input id="i1" type="radio" name="i"/>
<input id="i2" type="radio" name="i"/>
<input id="i3" type="radio" name="i"/>
<input id="i4" type="radio" name="i"/>
<input id="i5" type="radio" name="i"/>
<input id="i6" type="radio" name="i"/>
<input id="i7" type="radio" name="i"/>
<input id="i8" type="radio" name="i"/>
<div id="container"><div class="section">
<div class="doc">
<span class="comment"> Copyright 2014 Google LLC</span><span class="comment"></span><span class="comment"> Licensed under the Apache License, Version 2.0 (the "License");</span><span class="comment"> you may not use this file except in compliance with the License.</span><span class="comment"> You may obtain a copy of the License at</span><span class="comment"></span><span class="comment">      http://www.apache.org/licenses/LICENSE-2.0</span><span class="comment"></span><span class="comment"> Unless required by applicable law or agreed to in writing, software</span><span class="comment"> distributed under the License is distributed on an "AS IS" BASIS,</span><span class="comment"> WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><span class="comment"> See the License for the specific language governing permissions and</span><span class="comment"> limitations under the License.</span></div>
<div class="code"><pre><code>
<span class="keyword">package</span> storage

<span class="keyword">import</span> (
	<label for="i0"><span class="lit-string i0">"context"</span></label>
	<label for="i1"><span class="lit-string i1">"encoding/base64"</span></label>
	<label for="i2"><span class="lit-string i2">"errors"</span></label>
	<label for="i3"><span class="lit-string i3">"fmt"</span></label>
	<label for="i4"><span class="lit-string i4">"io"</span></label>
	<label for="i5"><span class="lit-string i5">"sync"</span></label>
	<label for="i6"><span class="lit-string i6">"unicode/utf8"</span></label>

	<label for="i7"><span class="lit-string i7">"google.golang.org/api/googleapi"</span></label>
	<a href="../../../../pkg/google.golang.org/api/storage/v1.html" class="ident i8">raw</a> <label for="i8"><span class="lit-string i8">"google.golang.org/api/storage/v1"</span></label>
)
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> A Writer writes a Cloud Storage object.</span></div>
<div class="code"><pre><code></code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> ObjectAttrs are optional attributes to set on the object. Any attributes</span><span class="comment">	 must be initialized before the first Write call. Nil or zero-valued</span><span class="comment">	 attributes are ignored.</span></div>
<div class="code"><pre><code>	<a href="storage.go.html#line-1068" class="ident">ObjectAttrs</a>
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> SendCRC specifies whether to transmit a CRC32C field. It should be set</span><span class="comment">	 to true in addition to setting the Writer's CRC32C field, because zero</span><span class="comment">	 is a valid CRC and normally a zero would not be transmitted.</span><span class="comment">	 If a CRC32C is sent, and the data written does not match the checksum,</span><span class="comment">	 the write will be rejected.</span></div>
<div class="code"><pre><code>	<a href="../../../../use/cloud.google.com/go/storage..Writer.SendCRC32C.html" class="ident">SendCRC32C</a> <a href="../../../../pkg/builtin.html#name-bool" class="ident">bool</a>
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> ChunkSize controls the maximum number of bytes of the object that the</span><span class="comment">	 Writer will attempt to send to the server in a single request. Objects</span><span class="comment">	 smaller than the size will be sent in a single request, while larger</span><span class="comment">	 objects will be split over multiple requests. The size will be rounded up</span><span class="comment">	 to the nearest multiple of 256K.</span><span class="comment">	</span><span class="comment">	 ChunkSize will default to a reasonable value. If you perform many</span><span class="comment">	 concurrent writes of small objects (under ~8MB), you may wish set ChunkSize</span><span class="comment">	 to a value that matches your objects' sizes to avoid consuming large</span><span class="comment">	 amounts of memory. See</span><span class="comment">	 https://cloud.google.com/storage/docs/json_api/v1/how-tos/upload#size</span><span class="comment">	 for more information about performance trade-offs related to ChunkSize.</span><span class="comment">	</span><span class="comment">	 If ChunkSize is set to zero, chunking will be disabled and the object will</span><span class="comment">	 be uploaded in a single request without the use of a buffer. This will</span><span class="comment">	 further reduce memory used during uploads, but will also prevent the writer</span><span class="comment">	 from retrying in case of a transient error from the server, since a buffer</span><span class="comment">	 is required in order to retry the failed request.</span><span class="comment">	</span><span class="comment">	 ChunkSize must be set before the first Write call.</span></div>
<div class="code"><pre><code>	<a href="../../../../use/cloud.google.com/go/storage..Writer.ChunkSize.html" class="ident">ChunkSize</a> <a href="../../../../pkg/builtin.html#name-int" class="ident">int</a>
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> ProgressFunc can be used to monitor the progress of a large write.</span><span class="comment">	 operation. If ProgressFunc is not nil and writing requires multiple</span><span class="comment">	 calls to the underlying service (see</span><span class="comment">	 https://cloud.google.com/storage/docs/json_api/v1/how-tos/resumable-upload),</span><span class="comment">	 then ProgressFunc will be invoked after each call with the number of bytes of</span><span class="comment">	 content copied so far.</span><span class="comment">	</span><span class="comment">	 ProgressFunc should return quickly without blocking.</span></div>
<div class="code"><pre><code>	<a href="../../../../use/cloud.google.com/go/storage..Writer.ProgressFunc.html" class="ident">ProgressFunc</a> <span class="keyword">func</span>(<a href="../../../../pkg/builtin.html#name-int64" class="ident">int64</a>)

	<a href="../../../../use/cloud.google.com/go/storage..Writer.ctx*0230c.html" class="ident">ctx</a> <a href="../../../../pkg/context.html" class="ident i0">context</a>.<a href="../../../context/context.go.html#line-62" class="ident">Context</a>
	<a href="../../../../use/cloud.google.com/go/storage..Writer.o*65c74.html" class="ident">o</a>   *<a href="storage.go.html#line-735" class="ident">ObjectHandle</a>

	<a href="../../../../use/cloud.google.com/go/storage..Writer.opened*50236.html" class="ident">opened</a> <a href="../../../../pkg/builtin.html#name-bool" class="ident">bool</a>
	<a href="../../../../use/cloud.google.com/go/storage..Writer.pw*30c95.html" class="ident">pw</a>     *<a href="../../../../pkg/io.html" class="ident i4">io</a>.<a href="../../../io/pipe.go.html#line-153" class="ident">PipeWriter</a>

	<a href="../../../../use/cloud.google.com/go/storage..Writer.donec*6d1d6.html" class="ident">donec</a> <span class="keyword">chan</span> <span class="keyword">struct</span>{} <span class="comment">// closed after err and obj are set.</span>
	<a href="../../../../use/cloud.google.com/go/storage..Writer.obj*772a5.html" class="ident">obj</a>   *<a href="storage.go.html#line-1068" class="ident">ObjectAttrs</a>

	<a href="../../../../use/cloud.google.com/go/storage..Writer.mu*19503.html" class="ident">mu</a>  <a href="../../../../pkg/sync.html" class="ident i5">sync</a>.<a href="../../../sync/mutex.go.html#line-25" class="ident">Mutex</a>
	<a href="../../../../use/cloud.google.com/go/storage..Writer.err*d9eb2.html" class="ident">err</a> <a href="../../../../pkg/builtin.html#name-error" class="ident">error</a>
}

<span class="keyword">func</span> (<label for="r0" class="ident">w</label> *<a href="#line-31" class="ident">Writer</a>) <label for="r1" class="ident"><a href="../../../../use/cloud.google.com/go/storage..Writer.open*2348f.html" class="ident">open</a></label>() <a href="../../../../pkg/builtin.html#name-error" class="ident">error</a> {
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> Check the developer didn't change the object Name (this is unfortunate, but</span><span class="comment">	 we don't want to store an object under the wrong name).</span></div>
<div class="code"><pre><code>	<span class="keyword">if</span> <label for="r2" class="ident">attrs</label>.<a href="storage.go.html#line-1075" class="ident">Name</a> != <label for="r0" class="ident">w</label>.<a href="#line-77" class="ident">o</a>.<a href="storage.go.html#line-738" class="ident">object</a> {
		<span class="keyword">return</span> <a href="../../../../pkg/fmt.html" class="ident i3">fmt</a>.<a href="../../../fmt/errors.go.html#line-17" class="ident">Errorf</a>(<span class="lit-string">"storage: Writer.Name %q does not match object name %q"</span>, <label for="r2" class="ident">attrs</label>.<a href="storage.go.html#line-1075" class="ident">Name</a>, <label for="r0" class="ident">w</label>.<a href="#line-77" class="ident">o</a>.<a href="storage.go.html#line-738" class="ident">object</a>)
	}
	<span class="keyword">if</span> !<a href="../../../../pkg/unicode/utf8.html" class="ident i6">utf8</a>.<a href="../../../unicode/utf8/utf8.go.html#line-497" class="ident">ValidString</a>(<label for="r2" class="ident">attrs</label>.<a href="storage.go.html#line-1075" class="ident">Name</a>) {
		<span class="keyword">return</span> <a href="../../../../pkg/fmt.html" class="ident i3">fmt</a>.<a href="../../../fmt/errors.go.html#line-17" class="ident">Errorf</a>(<span class="lit-string">"storage: object name %q is not valid UTF-8"</span>, <label for="r2" class="ident">attrs</label>.<a href="storage.go.html#line-1075" class="ident">Name</a>)
	}
	<span class="keyword">if</span> <label for="r2" class="ident">attrs</label>.<a href="storage.go.html#line-1191" class="ident">KMSKeyName</a> != <span class="lit-string">""</span> &amp;&amp; <label for="r0" class="ident">w</label>.<a href="#line-77" class="ident">o</a>.<a href="storage.go.html#line-742" class="ident">encryptionKey</a> != <a href="../../../../pkg/builtin.html#name-nil" class="ident">nil</a> {
		<span class="keyword">return</span> <a href="../../../../pkg/errors.html" class="ident i2">errors</a>.<a href="../../../errors/errors.go.html#line-58" class="ident">New</a>(<span class="lit-string">"storage: cannot use KMSKeyName with a customer-supplied encryption key"</span>)
	}
	<label for="r3" class="ident">pr</label>, <label for="r4" class="ident">pw</label> := <a href="../../../../pkg/io.html" class="ident i4">io</a>.<a href="../../../io/pipe.go.html#line-197" class="ident">Pipe</a>()
	<label for="r0" class="ident">w</label>.<a href="#line-80" class="ident">pw</a> = <label for="r4" class="ident">pw</label>
	<label for="r0" class="ident">w</label>.<a href="#line-79" class="ident">opened</a> = <a href="../../../../pkg/builtin.html#name-true" class="ident">true</a>

	<span class="keyword">go</span> <label for="r0" class="ident">w</label>.<a href="#line-239" class="ident">monitorCancel</a>()

	<span class="keyword">if</span> <label for="r0" class="ident">w</label>.<a href="#line-64" class="ident">ChunkSize</a> &lt; <span class="lit-number">0</span> {
		<span class="keyword">return</span> <a href="../../../../pkg/errors.html" class="ident i2">errors</a>.<a href="../../../errors/errors.go.html#line-58" class="ident">New</a>(<span class="lit-string">"storage: Writer.ChunkSize must be non-negative"</span>)
	}
	<label for="r5" class="ident">mediaOpts</label> := []<a href="../../../../pkg/google.golang.org/api/googleapi.html" class="ident i7">googleapi</a>.<a href="../../../google.golang.org/api/googleapi/googleapi.go.html#line-210" class="ident">MediaOption</a>{
		<a href="../../../../pkg/google.golang.org/api/googleapi.html" class="ident i7">googleapi</a>.<a href="../../../google.golang.org/api/googleapi/googleapi.go.html#line-244" class="ident">ChunkSize</a>(<label for="r0" class="ident">w</label>.<a href="#line-64" class="ident">ChunkSize</a>),
	}
	<span class="keyword">if</span> <label for="r6" class="ident">c</label> := <label for="r2" class="ident">attrs</label>.<a href="storage.go.html#line-1078" class="ident">ContentType</a>; <label for="r6" class="ident">c</label> != <span class="lit-string">""</span> {
		<label for="r5" class="ident">mediaOpts</label> = <a href="../../../../pkg/builtin.html#name-append" class="ident">append</a>(<label for="r5" class="ident">mediaOpts</label>, <a href="../../../../pkg/google.golang.org/api/googleapi.html" class="ident i7">googleapi</a>.<a href="../../../google.golang.org/api/googleapi/googleapi.go.html#line-225" class="ident">ContentType</a>(<label for="r6" class="ident">c</label>))
	}

	<span class="keyword">go</span> <span class="keyword">func</span>() {
		<span class="keyword">defer</span> <a href="../../../../pkg/builtin.html#name-close" class="ident">close</a>(<label for="r0" class="ident">w</label>.<a href="#line-82" class="ident">donec</a>)

		<label for="r7" class="ident">rawObj</label> := <label for="r2" class="ident">attrs</label>.<a href="storage.go.html#line-1045" class="ident">toRawObject</a>(<label for="r0" class="ident">w</label>.<a href="#line-77" class="ident">o</a>.<a href="storage.go.html#line-737" class="ident">bucket</a>)
		<span class="keyword">if</span> <label for="r0" class="ident">w</label>.<a href="#line-42" class="ident">SendCRC32C</a> {
			<label for="r7" class="ident">rawObj</label>.<a href="../../../google.golang.org/api/storage/v1/storage-gen.go.html#line-1699" class="ident">Crc32c</a> = <a href="storage.go.html#line-1271" class="ident">encodeUint32</a>(<label for="r2" class="ident">attrs</label>.<a href="storage.go.html#line-1138" class="ident">CRC32C</a>)
		}
		<span class="keyword">if</span> <label for="r0" class="ident">w</label>.<a href="storage.go.html#line-1131" class="ident">MD5</a> != <a href="../../../../pkg/builtin.html#name-nil" class="ident">nil</a> {
			<label for="r7" class="ident">rawObj</label>.<a href="../../../google.golang.org/api/storage/v1/storage-gen.go.html#line-1746" class="ident">Md5Hash</a> = <a href="../../../../pkg/encoding/base64.html" class="ident i1">base64</a>.<a href="../../../encoding/base64/base64.go.html#line-99" class="ident">StdEncoding</a>.<a href="../../../encoding/base64/base64.go.html#line-177" class="ident">EncodeToString</a>(<label for="r0" class="ident">w</label>.<a href="storage.go.html#line-1131" class="ident">MD5</a>)
		}
		<span class="keyword">if</span> <label for="r0" class="ident">w</label>.<a href="#line-77" class="ident">o</a>.<a href="storage.go.html#line-736" class="ident">c</a>.<a href="storage.go.html#line-94" class="ident">envHost</a> != <span class="lit-string">""</span> {
			<label for="r0" class="ident">w</label>.<a href="#line-77" class="ident">o</a>.<a href="storage.go.html#line-736" class="ident">c</a>.<a href="storage.go.html#line-90" class="ident">raw</a>.<a href="../../../google.golang.org/api/storage/v1/storage-gen.go.html#line-152" class="ident">BasePath</a> = <a href="../../../../pkg/fmt.html" class="ident i3">fmt</a>.<a href="../../../fmt/print.go.html#line-217" class="ident">Sprintf</a>(<span class="lit-string">"%s://%s"</span>, <label for="r0" class="ident">w</label>.<a href="#line-77" class="ident">o</a>.<a href="storage.go.html#line-736" class="ident">c</a>.<a href="storage.go.html#line-92" class="ident">scheme</a>, <label for="r0" class="ident">w</label>.<a href="#line-77" class="ident">o</a>.<a href="storage.go.html#line-736" class="ident">c</a>.<a href="storage.go.html#line-94" class="ident">envHost</a>)
		}
		<label for="r8" class="ident">call</label> := <label for="r0" class="ident">w</label>.<a href="#line-77" class="ident">o</a>.<a href="storage.go.html#line-736" class="ident">c</a>.<a href="storage.go.html#line-90" class="ident">raw</a>.<a href="../../../google.golang.org/api/storage/v1/storage-gen.go.html#line-167" class="ident">Objects</a>.<a href="../../../google.golang.org/api/storage/v1/storage-gen.go.html#line-9884" class="ident">Insert</a>(<label for="r0" class="ident">w</label>.<a href="#line-77" class="ident">o</a>.<a href="storage.go.html#line-737" class="ident">bucket</a>, <label for="r7" class="ident">rawObj</label>).
			<a href="../../../google.golang.org/api/storage/v1/storage-gen.go.html#line-10012" class="ident">Media</a>(<label for="r3" class="ident">pr</label>, <label for="r5" class="ident">mediaOpts</label>...).
			<a href="../../../google.golang.org/api/storage/v1/storage-gen.go.html#line-9984" class="ident">Projection</a>(<span class="lit-string">"full"</span>).
			<a href="../../../google.golang.org/api/storage/v1/storage-gen.go.html#line-10057" class="ident">Context</a>(<label for="r0" class="ident">w</label>.<a href="#line-76" class="ident">ctx</a>).
			<a href="../../../google.golang.org/api/storage/v1/storage-gen.go.html#line-9952" class="ident">Name</a>(<label for="r0" class="ident">w</label>.<a href="#line-77" class="ident">o</a>.<a href="storage.go.html#line-738" class="ident">object</a>)

		<span class="keyword">if</span> <label for="r0" class="ident">w</label>.<a href="#line-74" class="ident">ProgressFunc</a> != <a href="../../../../pkg/builtin.html#name-nil" class="ident">nil</a> {
			<label for="r8" class="ident">call</label>.<a href="../../../google.golang.org/api/storage/v1/storage-gen.go.html#line-10039" class="ident">ProgressUpdater</a>(<span class="keyword">func</span>(<label for="r9" class="ident">n</label>, <label for="r10" class="ident">_</label> <a href="../../../../pkg/builtin.html#name-int64" class="ident">int64</a>) { <label for="r0" class="ident">w</label>.<a href="#line-74" class="ident">ProgressFunc</a>(<label for="r9" class="ident">n</label>) })
		}
		<span class="keyword">if</span> <label for="r2" class="ident">attrs</label>.<a href="storage.go.html#line-1191" class="ident">KMSKeyName</a> != <span class="lit-string">""</span> {
			<label for="r8" class="ident">call</label>.<a href="../../../google.golang.org/api/storage/v1/storage-gen.go.html#line-9943" class="ident">KmsKeyName</a>(<label for="r2" class="ident">attrs</label>.<a href="storage.go.html#line-1191" class="ident">KMSKeyName</a>)
		}
		<span class="keyword">if</span> <label for="r2" class="ident">attrs</label>.<a href="storage.go.html#line-1111" class="ident">PredefinedACL</a> != <span class="lit-string">""</span> {
			<label for="r8" class="ident">call</label>.<a href="../../../google.golang.org/api/storage/v1/storage-gen.go.html#line-9972" class="ident">PredefinedAcl</a>(<label for="r2" class="ident">attrs</label>.<a href="storage.go.html#line-1111" class="ident">PredefinedACL</a>)
		}
		<span class="keyword">if</span> <label for="r11" class="ident">err</label> := <a href="storage.go.html#line-1578" class="ident">setEncryptionHeaders</a>(<label for="r8" class="ident">call</label>.<a href="../../../google.golang.org/api/storage/v1/storage-gen.go.html#line-10064" class="ident">Header</a>(), <label for="r0" class="ident">w</label>.<a href="#line-77" class="ident">o</a>.<a href="storage.go.html#line-742" class="ident">encryptionKey</a>, <a href="../../../../pkg/builtin.html#name-false" class="ident">false</a>); <label for="r11" class="ident">err</label> != <a href="../../../../pkg/builtin.html#name-nil" class="ident">nil</a> {
			<label for="r0" class="ident">w</label>.<a href="#line-85" class="ident">mu</a>.<a href="../../../sync/mutex.go.html#line-72" class="ident">Lock</a>()
			<label for="r0" class="ident">w</label>.<a href="#line-86" class="ident">err</a> = <label for="r11" class="ident">err</label>
			<label for="r0" class="ident">w</label>.<a href="#line-85" class="ident">mu</a>.<a href="../../../sync/mutex.go.html#line-179" class="ident">Unlock</a>()
			<label for="r3" class="ident">pr</label>.<a href="../../../io/pipe.go.html#line-148" class="ident">CloseWithError</a>(<label for="r11" class="ident">err</label>)
			<span class="keyword">return</span>
		}
		<span class="keyword">var</span> <label for="r12" class="ident">resp</label> *<a href="../../../../pkg/google.golang.org/api/storage/v1.html" class="ident i8">raw</a>.<a href="../../../google.golang.org/api/storage/v1/storage-gen.go.html#line-1666" class="ident">Object</a>
		<label for="r13" class="ident">err</label> := <a href="storage.go.html#line-1443" class="ident">applyConds</a>(<span class="lit-string">"NewWriter"</span>, <label for="r0" class="ident">w</label>.<a href="#line-77" class="ident">o</a>.<a href="storage.go.html#line-740" class="ident">gen</a>, <label for="r0" class="ident">w</label>.<a href="#line-77" class="ident">o</a>.<a href="storage.go.html#line-741" class="ident">conds</a>, <label for="r8" class="ident">call</label>)
		<span class="keyword">if</span> <label for="r13" class="ident">err</label> == <a href="../../../../pkg/builtin.html#name-nil" class="ident">nil</a> {
			<span class="keyword">if</span> <label for="r0" class="ident">w</label>.<a href="#line-77" class="ident">o</a>.<a href="storage.go.html#line-743" class="ident">userProject</a> != <span class="lit-string">""</span> {
				<label for="r8" class="ident">call</label>.<a href="../../../google.golang.org/api/storage/v1/storage-gen.go.html#line-9999" class="ident">UserProject</a>(<label for="r0" class="ident">w</label>.<a href="#line-77" class="ident">o</a>.<a href="storage.go.html#line-743" class="ident">userProject</a>)
			}
			<a href="storage.go.html#line-80" class="ident">setClientHeader</a>(<label for="r8" class="ident">call</label>.<a href="../../../google.golang.org/api/storage/v1/storage-gen.go.html#line-10064" class="ident">Header</a>())
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> The internals that perform call.Do automatically retry both the initial</span><span class="comment">			 call to set up the upload as well as calls to upload individual chunks</span><span class="comment">			 for a resumable upload (as long as the chunk size is non-zero). Hence</span><span class="comment">			 there is no need to add retries here.</span></div>
<div class="code"><pre><code>			<label for="r12" class="ident">resp</label>, <label for="r13" class="ident">err</label> = <label for="r8" class="ident">call</label>.<a href="../../../google.golang.org/api/storage/v1/storage-gen.go.html#line-10117" class="ident">Do</a>()
		}
		<span class="keyword">if</span> <label for="r13" class="ident">err</label> != <a href="../../../../pkg/builtin.html#name-nil" class="ident">nil</a> {
			<label for="r0" class="ident">w</label>.<a href="#line-85" class="ident">mu</a>.<a href="../../../sync/mutex.go.html#line-72" class="ident">Lock</a>()
			<label for="r0" class="ident">w</label>.<a href="#line-86" class="ident">err</a> = <label for="r13" class="ident">err</label>
			<label for="r0" class="ident">w</label>.<a href="#line-85" class="ident">mu</a>.<a href="../../../sync/mutex.go.html#line-179" class="ident">Unlock</a>()
			<label for="r3" class="ident">pr</label>.<a href="../../../io/pipe.go.html#line-148" class="ident">CloseWithError</a>(<label for="r13" class="ident">err</label>)
			<span class="keyword">return</span>
		}
		<label for="r0" class="ident">w</label>.<a href="#line-83" class="ident">obj</a> = <a href="storage.go.html#line-1214" class="ident">newObject</a>(<label for="r12" class="ident">resp</label>)
	}()
	<span class="keyword">return</span> <a href="../../../../pkg/builtin.html#name-nil" class="ident">nil</a>
}
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> Write appends to w. It implements the io.Writer interface.</span><span class="comment"></span><span class="comment"> Since writes happen asynchronously, Write may return a nil</span><span class="comment"> error even though the write failed (or will fail). Always</span><span class="comment"> use the error returned from Writer.Close to determine if</span><span class="comment"> the upload was successful.</span><span class="comment"></span><span class="comment"> Writes will be retried on transient errors from the server, unless</span><span class="comment"> Writer.ChunkSize has been set to zero.</span></div>
<div class="code"><pre><code><span class="keyword">func</span> (<label for="r14" class="ident">w</label> *<a href="#line-31" class="ident">Writer</a>) <label for="r15" class="ident"><a href="../../../../use/cloud.google.com/go/storage..Writer.Write.html" class="ident">Write</a></label>(<label for="r16" class="ident">p</label> []<a href="../../../../pkg/builtin.html#name-byte" class="ident">byte</a>) (<label for="r17" class="ident">n</label> <a href="../../../../pkg/builtin.html#name-int" class="ident">int</a>, <label for="r18" class="ident">err</label> <a href="../../../../pkg/builtin.html#name-error" class="ident">error</a>) {
	<label for="r14" class="ident">w</label>.<a href="#line-85" class="ident">mu</a>.<a href="../../../sync/mutex.go.html#line-72" class="ident">Lock</a>()
	<label for="r19" class="ident">werr</label> := <label for="r14" class="ident">w</label>.<a href="#line-86" class="ident">err</a>
	<label for="r14" class="ident">w</label>.<a href="#line-85" class="ident">mu</a>.<a href="../../../sync/mutex.go.html#line-179" class="ident">Unlock</a>()
	<span class="keyword">if</span> <label for="r19" class="ident">werr</label> != <a href="../../../../pkg/builtin.html#name-nil" class="ident">nil</a> {
		<span class="keyword">return</span> <span class="lit-number">0</span>, <label for="r19" class="ident">werr</label>
	}
	<span class="keyword">if</span> !<label for="r14" class="ident">w</label>.<a href="#line-79" class="ident">opened</a> {
		<span class="keyword">if</span> <label for="r20" class="ident">err</label> := <label for="r14" class="ident">w</label>.<a href="#line-89" class="ident">open</a>(); <label for="r20" class="ident">err</label> != <a href="../../../../pkg/builtin.html#name-nil" class="ident">nil</a> {
			<span class="keyword">return</span> <span class="lit-number">0</span>, <label for="r20" class="ident">err</label>
		}
	}
	<label for="r17" class="ident">n</label>, <label for="r18" class="ident">err</label> = <label for="r14" class="ident">w</label>.<a href="#line-80" class="ident">pw</a>.<a href="../../../io/pipe.go.html#line-162" class="ident">Write</a>(<label for="r16" class="ident">p</label>)
	<span class="keyword">if</span> <label for="r18" class="ident">err</label> != <a href="../../../../pkg/builtin.html#name-nil" class="ident">nil</a> {
		<label for="r14" class="ident">w</label>.<a href="#line-85" class="ident">mu</a>.<a href="../../../sync/mutex.go.html#line-72" class="ident">Lock</a>()
		<label for="r21" class="ident">werr</label> := <label for="r14" class="ident">w</label>.<a href="#line-86" class="ident">err</a>
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> Preserve existing functionality that when context is canceled, Write will return</span><span class="comment">		 context.Canceled instead of "io: read/write on closed pipe". This hides the</span><span class="comment">		 pipe implementation detail from users and makes Write seem as though it's an RPC.</span></div>
<div class="code"><pre><code>		<span class="keyword">if</span> <label for="r21" class="ident">werr</label> == <a href="../../../../pkg/context.html" class="ident i0">context</a>.<a href="../../../context/context.go.html#line-157" class="ident">Canceled</a> || <label for="r21" class="ident">werr</label> == <a href="../../../../pkg/context.html" class="ident i0">context</a>.<a href="../../../context/context.go.html#line-161" class="ident">DeadlineExceeded</a> {
			<span class="keyword">return</span> <label for="r17" class="ident">n</label>, <label for="r21" class="ident">werr</label>
		}
	}
	<span class="keyword">return</span> <label for="r17" class="ident">n</label>, <label for="r18" class="ident">err</label>
}
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> Close completes the write operation and flushes any buffered data.</span><span class="comment"> If Close doesn't return an error, metadata about the written object</span><span class="comment"> can be retrieved by calling Attrs.</span></div>
<div class="code"><pre><code><span class="keyword">func</span> (<label for="r22" class="ident">w</label> *<a href="#line-31" class="ident">Writer</a>) <label for="r23" class="ident"><a href="../../../../use/cloud.google.com/go/storage..Writer.Close.html" class="ident">Close</a></label>() <a href="../../../../pkg/builtin.html#name-error" class="ident">error</a> {
	<span class="keyword">if</span> !<label for="r22" class="ident">w</label>.<a href="#line-79" class="ident">opened</a> {
		<span class="keyword">if</span> <label for="r24" class="ident">err</label> := <label for="r22" class="ident">w</label>.<a href="#line-89" class="ident">open</a>(); <label for="r24" class="ident">err</label> != <a href="../../../../pkg/builtin.html#name-nil" class="ident">nil</a> {
			<span class="keyword">return</span> <label for="r24" class="ident">err</label>
		}
	}
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> Closing either the read or write causes the entire pipe to close.</span></div>
<div class="code"><pre><code>	<span class="keyword">if</span> <label for="r25" class="ident">err</label> := <label for="r22" class="ident">w</label>.<a href="#line-80" class="ident">pw</a>.<a href="../../../io/pipe.go.html#line-168" class="ident">Close</a>(); <label for="r25" class="ident">err</label> != <a href="../../../../pkg/builtin.html#name-nil" class="ident">nil</a> {
		<span class="keyword">return</span> <label for="r25" class="ident">err</label>
	}

	&lt;-<label for="r22" class="ident">w</label>.<a href="#line-82" class="ident">donec</a>
	<label for="r22" class="ident">w</label>.<a href="#line-85" class="ident">mu</a>.<a href="../../../sync/mutex.go.html#line-72" class="ident">Lock</a>()
	<span class="keyword">defer</span> <label for="r22" class="ident">w</label>.<a href="#line-85" class="ident">mu</a>.<a href="../../../sync/mutex.go.html#line-179" class="ident">Unlock</a>()
	<span class="keyword">return</span> <label for="r22" class="ident">w</label>.<a href="#line-86" class="ident">err</a>
}
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> monitorCancel is intended to be used as a background goroutine. It monitors the</span><span class="comment"> context, and when it observes that the context has been canceled, it manually</span><span class="comment"> closes things that do not take a context.</span></div>
<div class="code"><pre><code><span class="keyword">func</span> (<label for="r26" class="ident">w</label> *<a href="#line-31" class="ident">Writer</a>) <label for="r27" class="ident"><a href="../../../../use/cloud.google.com/go/storage..Writer.monitorCancel*f1b33.html" class="ident">monitorCancel</a></label>() {
	<a href="../../../runtime/select.go.html#line-121"><span class="keyword">select</span></a> {
	<span class="keyword">case</span> <a href="../../../runtime/chan.go.html#line-438">&lt;-</a><label for="r26" class="ident">w</label>.<a href="#line-76" class="ident">ctx</a>.<a href="../../../context/context.go.html#line-99" class="ident">Done</a>():
		<label for="r26" class="ident">w</label>.<a href="#line-85" class="ident">mu</a>.<a href="../../../sync/mutex.go.html#line-72" class="ident">Lock</a>()
		<label for="r28" class="ident">werr</label> := <label for="r26" class="ident">w</label>.<a href="#line-76" class="ident">ctx</a>.<a href="../../../context/context.go.html#line-106" class="ident">Err</a>()
		<label for="r26" class="ident">w</label>.<a href="#line-86" class="ident">err</a> = <label for="r28" class="ident">werr</label>
		<label for="r26" class="ident">w</label>.<a href="#line-85" class="ident">mu</a>.<a href="../../../sync/mutex.go.html#line-179" class="ident">Unlock</a>()
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> Closing either the read or write causes the entire pipe to close.</span></div>
<div class="code"><pre><code>		<label for="r26" class="ident">w</label>.<a href="#line-257" class="ident">CloseWithError</a>(<label for="r28" class="ident">werr</label>)
	<span class="keyword">case</span> <a href="../../../runtime/chan.go.html#line-438">&lt;-</a><label for="r26" class="ident">w</label>.<a href="#line-82" class="ident">donec</a>:
	}
}
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> CloseWithError aborts the write operation with the provided error.</span><span class="comment"> CloseWithError always returns nil.</span><span class="comment"></span><span class="comment"> Deprecated: cancel the context passed to NewWriter instead.</span></div>
<div class="code"><pre><code><span class="keyword">func</span> (<label for="r29" class="ident">w</label> *<a href="#line-31" class="ident">Writer</a>) <label for="r30" class="ident"><a href="../../../../use/cloud.google.com/go/storage..Writer.CloseWithError.html" class="ident">CloseWithError</a></label>(<label for="r31" class="ident">err</label> <a href="../../../../pkg/builtin.html#name-error" class="ident">error</a>) <a href="../../../../pkg/builtin.html#name-error" class="ident">error</a> {
	<span class="keyword">if</span> !<label for="r29" class="ident">w</label>.<a href="#line-79" class="ident">opened</a> {
		<span class="keyword">return</span> <a href="../../../../pkg/builtin.html#name-nil" class="ident">nil</a>
	}
	<span class="keyword">return</span> <label for="r29" class="ident">w</label>.<a href="#line-80" class="ident">pw</a>.<a href="../../../io/pipe.go.html#line-178" class="ident">CloseWithError</a>(<label for="r31" class="ident">err</label>)
}
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> Attrs returns metadata about a successfully-written object.</span><span class="comment"> It's only valid to call it after Close returns nil.</span></div>
<div class="code"><pre><code><span class="keyword">func</span> (<label for="r32" class="ident">w</label> *<a href="#line-31" class="ident">Writer</a>) <label for="r33" class="ident"><a href="../../../../use/cloud.google.com/go/storage..Writer.Attrs.html" class="ident">Attrs</a></label>() *<a href="storage.go.html#line-1068" class="ident">ObjectAttrs</a> {
	<span class="keyword">return</span> <label for="r32" class="ident">w</label>.<a href="#line-83" class="ident">obj</a>
</code></pre></div></div>

</div><pre id="footer">
<table><tr><td><img src="../../../../png/go101-twitter.png"></td>
<td>The pages are generated with <a href="https://go101.org/article/tool-golds.html"><b>Golds</b></a> <i>v0.3.2-preview</i>. (GOOS=darwin GOARCH=amd64)
<b>Golds</b> is a <a href="https://go101.org">Go 101</a> project developed by <a href="https://tapirgames.com">Tapir Liu</a>.
PR and bug reports are welcome and can be submitted to <a href="https://github.com/go101/golds">the issue list</a>.
Please follow <a href="https://twitter.com/go100and1">@Go100and1</a> (reachable from the left QR code) to get the latest news of <b>Golds</b>.</td></tr></table></pre>