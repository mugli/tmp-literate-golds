<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Source: doc.go in package github.com/go-git/go-git/v5/plumbing/format/idxfile</title>
<link href="../../../../../../../../css/lightLiterate-v0.3.2-preview.css" rel="stylesheet">
<script src="../../../../../../../../jvs/golds-v0.3.2-preview.js"></script>
<body onload="onPageLoad()"><div>

<pre id="header"><code><span class="title">Source File</span>
	doc.go

<span class="title">Belonging Package</span>
	<a href="../../../../../../../../pkg/github.com/go-git/go-git/v5/plumbing/format/idxfile.html">github.com/go-git/go-git/v5/plumbing/format/idxfile</a>
</code></pre>
<div id="container"><div class="section">
<div class="doc">
<span class="comment"> Package idxfile implements encoding and decoding of packfile idx files.</span><span class="comment"></span><span class="comment">  == Original (version 1) pack-*.idx files have the following format:</span><span class="comment"></span><span class="comment">    - The header consists of 256 4-byte network byte order</span><span class="comment">      integers.  N-th entry of this table records the number of</span><span class="comment">      objects in the corresponding pack, the first byte of whose</span><span class="comment">      object name is less than or equal to N.  This is called the</span><span class="comment">      'first-level fan-out' table.</span><span class="comment"></span><span class="comment">    - The header is followed by sorted 24-byte entries, one entry</span><span class="comment">      per object in the pack.  Each entry is:</span><span class="comment"></span><span class="comment">     4-byte network byte order integer, recording where the</span><span class="comment">     object is stored in the packfile as the offset from the</span><span class="comment">     beginning.</span><span class="comment"></span><span class="comment">     20-byte object name.</span><span class="comment"></span><span class="comment">   - The file is concluded with a trailer:</span><span class="comment"></span><span class="comment">     A copy of the 20-byte SHA1 checksum at the end of</span><span class="comment">     corresponding packfile.</span><span class="comment"></span><span class="comment">     20-byte SHA1-checksum of all of the above.</span><span class="comment"></span><span class="comment">   Pack Idx file:</span><span class="comment"></span><span class="comment">        --  +--------------------------------+</span><span class="comment">   fanout   | fanout[0] = 2 (for example)    |-.</span><span class="comment">   table    +--------------------------------+ |</span><span class="comment">            | fanout[1]                      | |</span><span class="comment">            +--------------------------------+ |</span><span class="comment">            | fanout[2]                      | |</span><span class="comment">            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ |</span><span class="comment">            | fanout[255] = total objects    |---.</span><span class="comment">        --  +--------------------------------+ | |</span><span class="comment">   main     | offset                         | | |</span><span class="comment">   index    | object name 00XXXXXXXXXXXXXXXX | | |</span><span class="comment">   tab      +--------------------------------+ | |</span><span class="comment">            | offset                         | | |</span><span class="comment">            | object name 00XXXXXXXXXXXXXXXX | | |</span><span class="comment">            +--------------------------------+&lt;+ |</span><span class="comment">          .-| offset                         |   |</span><span class="comment">          | | object name 01XXXXXXXXXXXXXXXX |   |</span><span class="comment">          | +--------------------------------+   |</span><span class="comment">          | | offset                         |   |</span><span class="comment">          | | object name 01XXXXXXXXXXXXXXXX |   |</span><span class="comment">          | ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~   |</span><span class="comment">          | | offset                         |   |</span><span class="comment">          | | object name FFXXXXXXXXXXXXXXXX |   |</span><span class="comment">        --| +--------------------------------+&lt;--+</span><span class="comment">  trailer | | packfile checksum              |</span><span class="comment">          | +--------------------------------+</span><span class="comment">          | | idxfile checksum               |</span><span class="comment">          | +--------------------------------+</span><span class="comment">          .---------.</span><span class="comment">                    |</span><span class="comment">  Pack file entry: &lt;+</span><span class="comment"></span><span class="comment">     packed object header:</span><span class="comment">     1-byte size extension bit (MSB)</span><span class="comment">           type (next 3 bit)</span><span class="comment">           size0 (lower 4-bit)</span><span class="comment">         n-byte sizeN (as long as MSB is set, each 7-bit)</span><span class="comment">         size0..sizeN form 4+7+7+..+7 bit integer, size0</span><span class="comment">         is the least significant part, and sizeN is the</span><span class="comment">         most significant part.</span><span class="comment">     packed object data:</span><span class="comment">         If it is not DELTA, then deflated bytes (the size above</span><span class="comment">         is the size before compression).</span><span class="comment">     If it is REF_DELTA, then</span><span class="comment">       20-byte base object name SHA1 (the size above is the</span><span class="comment">         size of the delta data that follows).</span><span class="comment">           delta data, deflated.</span><span class="comment">     If it is OFS_DELTA, then</span><span class="comment">       n-byte offset (see below) interpreted as a negative</span><span class="comment">         offset from the type-byte of the header of the</span><span class="comment">         ofs-delta entry (the size above is the size of</span><span class="comment">         the delta data that follows).</span><span class="comment">       delta data, deflated.</span><span class="comment"></span><span class="comment">     offset encoding:</span><span class="comment">       n bytes with MSB set in all but the last one.</span><span class="comment">       The offset is then the number constructed by</span><span class="comment">       concatenating the lower 7 bit of each byte, and</span><span class="comment">       for n &gt;= 2 adding 2^7 + 2^14 + ... + 2^(7*(n-1))</span><span class="comment">       to the result.</span><span class="comment"></span><span class="comment">   == Version 2 pack-*.idx files support packs larger than 4 GiB, and</span><span class="comment">      have some other reorganizations.  They have the format:</span><span class="comment"></span><span class="comment">     - A 4-byte magic number '\377tOc' which is an unreasonable</span><span class="comment">       fanout[0] value.</span><span class="comment"></span><span class="comment">     - A 4-byte version number (= 2)</span><span class="comment"></span><span class="comment">     - A 256-entry fan-out table just like v1.</span><span class="comment"></span><span class="comment">     - A table of sorted 20-byte SHA1 object names.  These are</span><span class="comment">       packed together without offset values to reduce the cache</span><span class="comment">       footprint of the binary search for a specific object name.</span><span class="comment"></span><span class="comment">     - A table of 4-byte CRC32 values of the packed object data.</span><span class="comment">       This is new in v2 so compressed data can be copied directly</span><span class="comment">       from pack to pack during repacking without undetected</span><span class="comment">       data corruption.</span><span class="comment"></span><span class="comment">     - A table of 4-byte offset values (in network byte order).</span><span class="comment">       These are usually 31-bit pack file offsets, but large</span><span class="comment">       offsets are encoded as an index into the next table with</span><span class="comment">       the msbit set.</span><span class="comment"></span><span class="comment">     - A table of 8-byte offset entries (empty for pack files less</span><span class="comment">       than 2 GiB).  Pack files are organized with heavily used</span><span class="comment">       objects toward the front, so most object references should</span><span class="comment">       not need to refer to this table.</span><span class="comment"></span><span class="comment">     - The same trailer as a v1 pack file:</span><span class="comment"></span><span class="comment">       A copy of the 20-byte SHA1 checksum at the end of</span><span class="comment">       corresponding packfile.</span><span class="comment"></span><span class="comment">       20-byte SHA1-checksum of all of the above.</span><span class="comment"></span><span class="comment"> Source:</span><span class="comment"> https://www.kernel.org/pub/software/scm/git/docs/v1.7.5/technical/pack-format.txt</span></div>
<div class="code"><pre><code></code></pre></div></div>

</div><pre id="footer">
<table><tr><td><img src="../../../../../../../../png/go101-twitter.png"></td>
<td>The pages are generated with <a href="https://go101.org/article/tool-golds.html"><b>Golds</b></a> <i>v0.3.2-preview</i>. (GOOS=darwin GOARCH=amd64)
<b>Golds</b> is a <a href="https://go101.org">Go 101</a> project developed by <a href="https://tapirgames.com">Tapir Liu</a>.
PR and bug reports are welcome and can be submitted to <a href="https://github.com/go101/golds">the issue list</a>.
Please follow <a href="https://twitter.com/go100and1">@Go100and1</a> (reachable from the left QR code) to get the latest news of <b>Golds</b>.</td></tr></table></pre>