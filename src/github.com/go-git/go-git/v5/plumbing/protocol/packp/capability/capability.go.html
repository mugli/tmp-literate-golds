<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Source: capability.go in package github.com/go-git/go-git/v5/plumbing/protocol/packp/capability</title>
<link href="../../../../../../../../../css/lightLiterate-v0.3.2-preview.css" rel="stylesheet">
<script src="../../../../../../../../../jvs/golds-v0.3.2-preview.js"></script>
<body onload="onPageLoad()"><div>

<pre id="header"><code><span class="title">Source File</span>
	capability.go

<span class="title">Belonging Package</span>
	<a href="../../../../../../../../../pkg/github.com/go-git/go-git/v5/plumbing/protocol/packp/capability.html">github.com/go-git/go-git/v5/plumbing/protocol/packp/capability</a>
</code></pre>
<style>input[type=radio] {display: none;}
input[id=r0]:checked ~pre label[for=r0],
input[id=r1]:checked ~pre label[for=r1]
{background: #226; color: #ff8;}
{background: brown; color: #eed;}
</style><input id="r0" type="radio" name="g"/>
<input id="r1" type="radio" name="g"/>
<div id="container"><div class="section">
<div class="doc">
<span class="comment"> Package capability defines the server and client capabilities.</span></div>
<div class="code"><pre><code><span class="keyword">package</span> capability
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> Capability describes a server or client capability.</span></div>
<div class="code"><pre><code><span class="keyword">type</span> <a href="../../../../../../../../../pkg/github.com/go-git/go-git/v5/plumbing/protocol/packp/capability.html#name-Capability" class="ident">Capability</a> <a href="../../../../../../../../../pkg/builtin.html#name-string" class="ident">string</a>

<span class="keyword">func</span> (<label for="r0" class="ident">n</label> <a href="#line-5" class="ident">Capability</a>) <label for="r1" class="ident"><a href="../../../../../../../../../use/github.com/go-git/go-git/v5/plumbing/protocol/packp/capability..Capability.String.html" class="ident">String</a></label>() <a href="../../../../../../../../../pkg/builtin.html#name-string" class="ident">string</a> {
	<span class="keyword">return</span> <a href="../../../../../../../../../pkg/builtin.html#name-string" class="ident">string</a>(<label for="r0" class="ident">n</label>)
}

</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> MultiACK capability allows the server to return "ACK obj-id continue" as</span><span class="comment">	 soon as it finds a commit that it can use as a common base, between the</span><span class="comment">	 client's wants and the client's have set.</span><span class="comment">	</span><span class="comment">	 By sending this early, the server can potentially head off the client</span><span class="comment">	 from walking any further down that particular branch of the client's</span><span class="comment">	 repository history.  The client may still need to walk down other</span><span class="comment">	 branches, sending have lines for those, until the server has a</span><span class="comment">	 complete cut across the DAG, or the client has said "done".</span><span class="comment">	</span><span class="comment">	 Without multi_ack, a client sends have lines in --date-order until</span><span class="comment">	 the server has found a common base.  That means the client will send</span><span class="comment">	 have lines that are already known by the server to be common, because</span><span class="comment">	 they overlap in time with another branch that the server hasn't found</span><span class="comment">	 a common base on yet.</span><span class="comment">	</span><span class="comment">	 For example suppose the client has commits in caps that the server</span><span class="comment">	 doesn't and the server has commits in lower case that the client</span><span class="comment">	 doesn't, as in the following diagram:</span><span class="comment">	</span><span class="comment">	        +---- u ---------------------- x</span><span class="comment">	       /              +----- y</span><span class="comment">	      /              /</span><span class="comment">	     a -- b -- c -- d -- E -- F</span><span class="comment">	        \</span><span class="comment">	 	+--- Q -- R -- S</span><span class="comment">	</span><span class="comment">	 If the client wants x,y and starts out by saying have F,S, the server</span><span class="comment">	 doesn't know what F,S is.  Eventually the client says "have d" and</span><span class="comment">	 the server sends "ACK d continue" to let the client know to stop</span><span class="comment">	 walking down that line (so don't send c-b-a), but it's not done yet,</span><span class="comment">	 it needs a base for x. The client keeps going with S-R-Q, until a</span><span class="comment">	 gets reached, at which point the server has a clear base and it all</span><span class="comment">	 ends.</span><span class="comment">	</span><span class="comment">	 Without multi_ack the client would have sent that c-b-a chain anyway,</span><span class="comment">	 interleaved with S-R-Q.</span></div>
<div class="code"><pre><code></code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> MultiACKDetailed is an extension of multi_ack that permits client to</span><span class="comment">	 better understand the server's in-memory state.</span></div>
<div class="code"><pre><code></code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> NoDone should only be used with the smart HTTP protocol. If</span><span class="comment">	 multi_ack_detailed and no-done are both present, then the sender is</span><span class="comment">	 free to immediately send a pack following its first "ACK obj-id ready"</span><span class="comment">	 message.</span><span class="comment">	</span><span class="comment">	 Without no-done in the smart HTTP protocol, the server session would</span><span class="comment">	 end and the client has to make another trip to send "done" before</span><span class="comment">	 the server can send the pack. no-done removes the last round and</span><span class="comment">	 thus slightly reduces latency.</span></div>
<div class="code"><pre><code></code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> ThinPack is one with deltas which reference base objects not</span><span class="comment">	 contained within the pack (but are known to exist at the receiving</span><span class="comment">	 end). This can reduce the network traffic significantly, but it</span><span class="comment">	 requires the receiving end to know how to "thicken" these packs by</span><span class="comment">	 adding the missing bases to the pack.</span><span class="comment">	</span><span class="comment">	 The upload-pack server advertises 'thin-pack' when it can generate</span><span class="comment">	 and send a thin pack. A client requests the 'thin-pack' capability</span><span class="comment">	 when it understands how to "thicken" it, notifying the server that</span><span class="comment">	 it can receive such a pack. A client MUST NOT request the</span><span class="comment">	 'thin-pack' capability if it cannot turn a thin pack into a</span><span class="comment">	 self-contained pack.</span><span class="comment">	</span><span class="comment">	 Receive-pack, on the other hand, is assumed by default to be able to</span><span class="comment">	 handle thin packs, but can ask the client not to use the feature by</span><span class="comment">	 advertising the 'no-thin' capability. A client MUST NOT send a thin</span><span class="comment">	 pack if the server advertises the 'no-thin' capability.</span><span class="comment">	</span><span class="comment">	 The reasons for this asymmetry are historical. The receive-pack</span><span class="comment">	 program did not exist until after the invention of thin packs, so</span><span class="comment">	 historically the reference implementation of receive-pack always</span><span class="comment">	 understood thin packs. Adding 'no-thin' later allowed receive-pack</span><span class="comment">	 to disable the feature in a backwards-compatible manner.</span></div>
<div class="code"><pre><code></code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> Sideband means that server can send, and client understand multiplexed</span><span class="comment">	 progress reports and error info interleaved with the packfile itself.</span><span class="comment">	</span><span class="comment">	 These two options are mutually exclusive. A modern client always</span><span class="comment">	 favors Sideband64k.</span><span class="comment">	</span><span class="comment">	 Either mode indicates that the packfile data will be streamed broken</span><span class="comment">	 up into packets of up to either 1000 bytes in the case of 'side_band',</span><span class="comment">	 or 65520 bytes in the case of 'side_band_64k'. Each packet is made up</span><span class="comment">	 of a leading 4-byte pkt-line length of how much data is in the packet,</span><span class="comment">	 followed by a 1-byte stream code, followed by the actual data.</span><span class="comment">	</span><span class="comment">	 The stream code can be one of:</span><span class="comment">	</span><span class="comment">	  1 - pack data</span><span class="comment">	  2 - progress messages</span><span class="comment">	  3 - fatal error message just before stream aborts</span><span class="comment">	</span><span class="comment">	 The "side-band-64k" capability came about as a way for newer clients</span><span class="comment">	 that can handle much larger packets to request packets that are</span><span class="comment">	 actually crammed nearly full, while maintaining backward compatibility</span><span class="comment">	 for the older clients.</span><span class="comment">	</span><span class="comment">	 Further, with side-band and its up to 1000-byte messages, it's actually</span><span class="comment">	 999 bytes of payload and 1 byte for the stream code. With side-band-64k,</span><span class="comment">	 same deal, you have up to 65519 bytes of data and 1 byte for the stream</span><span class="comment">	 code.</span><span class="comment">	</span><span class="comment">	 The client MUST send only maximum of one of "side-band" and "side-</span><span class="comment">	 band-64k".  Server MUST diagnose it as an error if client requests</span><span class="comment">	 both.</span></div>
<div class="code"><pre><code>	<a href="../../../../../../../../../pkg/github.com/go-git/go-git/v5/plumbing/protocol/packp/capability.html#name-Sideband" class="ident">Sideband</a>    <a href="#line-5" class="ident">Capability</a> = <span class="lit-string">"side-band"</span>
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> OFSDelta server can send, and client understand PACKv2 with delta</span><span class="comment">	 referring to its base by position in pack rather than by an obj-id. That</span><span class="comment">	 is, they can send/read OBJ_OFS_DELTA (aka type 6) in a packfile.</span></div>
<div class="code"><pre><code></code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> Agent the server may optionally send this capability to notify the client</span><span class="comment">	 that the server is running version `X`. The client may optionally return</span><span class="comment">	 its own agent string by responding with an `agent=Y` capability (but it</span><span class="comment">	 MUST NOT do so if the server did not mention the agent capability). The</span><span class="comment">	 `X` and `Y` strings may contain any printable ASCII characters except</span><span class="comment">	 space (i.e., the byte range 32 &lt; x &lt; 127), and are typically of the form</span><span class="comment">	 "package/version" (e.g., "git/1.8.3.1"). The agent strings are purely</span><span class="comment">	 informative for statistics and debugging purposes, and MUST NOT be used</span><span class="comment">	 to programmatically assume the presence or absence of particular features.</span></div>
<div class="code"><pre><code></code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> Shallow capability adds "deepen", "shallow" and "unshallow" commands to</span><span class="comment">	 the  fetch-pack/upload-pack protocol so clients can request shallow</span><span class="comment">	 clones.</span></div>
<div class="code"><pre><code></code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> DeepenSince adds "deepen-since" command to fetch-pack/upload-pack</span><span class="comment">	 protocol so the client can request shallow clones that are cut at a</span><span class="comment">	 specific time, instead of depth. Internally it's equivalent of doing</span><span class="comment">	 "rev-list --max-age=&lt;timestamp&gt;" on the server side. "deepen-since"</span><span class="comment">	 cannot be used with "deepen".</span></div>
<div class="code"><pre><code></code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> DeepenNot adds "deepen-not" command to fetch-pack/upload-pack</span><span class="comment">	 protocol so the client can request shallow clones that are cut at a</span><span class="comment">	 specific revision, instead of depth. Internally it's equivalent of</span><span class="comment">	 doing "rev-list --not &lt;rev&gt;" on the server side. "deepen-not"</span><span class="comment">	 cannot be used with "deepen", but can be used with "deepen-since".</span></div>
<div class="code"><pre><code></code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> DeepenRelative if this capability is requested by the client, the</span><span class="comment">	 semantics of "deepen" command is changed. The "depth" argument is the</span><span class="comment">	 depth from the current shallow boundary, instead of the depth from</span><span class="comment">	 remote refs.</span></div>
<div class="code"><pre><code></code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> NoProgress the client was started with "git clone -q" or something, and</span><span class="comment">	 doesn't want that side band 2. Basically the client just says "I do not</span><span class="comment">	 wish to receive stream 2 on sideband, so do not send it to me, and if</span><span class="comment">	 you did, I will drop it on the floor anyway".  However, the sideband</span><span class="comment">	 channel 3 is still used for error responses.</span></div>
<div class="code"><pre><code></code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> IncludeTag capability is about sending annotated tags if we are</span><span class="comment">	 sending objects they point to.  If we pack an object to the client, and</span><span class="comment">	 a tag object points exactly at that object, we pack the tag object too.</span><span class="comment">	 In general this allows a client to get all new annotated tags when it</span><span class="comment">	 fetches a branch, in a single network connection.</span><span class="comment">	</span><span class="comment">	 Clients MAY always send include-tag, hardcoding it into a request when</span><span class="comment">	 the server advertises this capability. The decision for a client to</span><span class="comment">	 request include-tag only has to do with the client's desires for tag</span><span class="comment">	 data, whether or not a server had advertised objects in the</span><span class="comment">	 refs/tags namespace.</span><span class="comment">	</span><span class="comment">	 Servers MUST pack the tags if their referrant is packed and the client</span><span class="comment">	 has requested include-tags.</span><span class="comment">	</span><span class="comment">	 Clients MUST be prepared for the case where a server has ignored</span><span class="comment">	 include-tag and has not actually sent tags in the pack.  In such</span><span class="comment">	 cases the client SHOULD issue a subsequent fetch to acquire the tags</span><span class="comment">	 that include-tag would have otherwise given the client.</span><span class="comment">	</span><span class="comment">	 The server SHOULD send include-tag, if it supports it, regardless</span><span class="comment">	 of whether or not there are tags available.</span></div>
<div class="code"><pre><code></code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> ReportStatus the receive-pack process can receive a 'report-status'</span><span class="comment">	 capability, which tells it that the client wants a report of what</span><span class="comment">	 happened after a packfile upload and reference update. If the pushing</span><span class="comment">	 client requests this capability, after unpacking and updating references</span><span class="comment">	 the server will respond with whether the packfile unpacked successfully</span><span class="comment">	 and if each reference was updated successfully. If any of those were not</span><span class="comment">	 successful, it will send back an error message.  See pack-protocol.txt</span><span class="comment">	 for example messages.</span></div>
<div class="code"><pre><code></code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> DeleteRefs If the server sends back this capability, it means that</span><span class="comment">	 it is capable of accepting a zero-id value as the target</span><span class="comment">	 value of a reference update.  It is not sent back by the client, it</span><span class="comment">	 simply informs the client that it can be sent zero-id values</span><span class="comment">	 to delete references</span></div>
<div class="code"><pre><code></code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> Quiet If the receive-pack server advertises this capability, it is</span><span class="comment">	 capable of silencing human-readable progress output which otherwise may</span><span class="comment">	 be shown when processing the received pack. A send-pack client should</span><span class="comment">	 respond with the 'quiet' capability to suppress server-side progress</span><span class="comment">	 reporting if the local progress reporting is also being suppressed</span><span class="comment">	 (e.g., via `push -q`, or if stderr does not go to a tty).</span></div>
<div class="code"><pre><code></code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> Atomic If the server sends this capability it is capable of accepting</span><span class="comment">	 atomic pushes. If the pushing client requests this capability, the server</span><span class="comment">	 will update the refs in one atomic transaction. Either all refs are</span><span class="comment">	 updated or none.</span></div>
<div class="code"><pre><code></code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> PushOptions If the server sends this capability it is able to accept</span><span class="comment">	 push options after the update commands have been sent, but before the</span><span class="comment">	 packfile is streamed. If the pushing client requests this capability,</span><span class="comment">	 the server will pass the options to the pre- and post- receive hooks</span><span class="comment">	 that process this push request.</span></div>
<div class="code"><pre><code></code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> AllowTipSHA1InWant if the upload-pack server advertises this capability,</span><span class="comment">	 fetch-pack may send "want" lines with SHA-1s that exist at the server but</span><span class="comment">	 are not advertised by upload-pack.</span></div>
<div class="code"><pre><code></code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> AllowReachableSHA1InWant if the upload-pack server advertises this</span><span class="comment">	 capability, fetch-pack may send "want" lines with SHA-1s that exist at</span><span class="comment">	 the server but are not advertised by upload-pack.</span></div>
<div class="code"><pre><code></code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> PushCert the receive-pack server that advertises this capability is</span><span class="comment">	 willing to accept a signed push certificate, and asks the &lt;nonce&gt; to be</span><span class="comment">	 included in the push certificate.  A send-pack client MUST NOT</span><span class="comment">	 send a push-cert packet unless the receive-pack server advertises</span><span class="comment">	 this capability.</span></div>
<div class="code"><pre><code></code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> SymRef symbolic reference support for better negotiation.</span></div>
<div class="code"><pre><code>	<a href="../../../../../../../../../pkg/github.com/go-git/go-git/v5/plumbing/protocol/packp/capability.html#name-SymRef" class="ident">SymRef</a> <a href="#line-5" class="ident">Capability</a> = <span class="lit-string">"symref"</span>
)

<span class="keyword">const</span> <a href="../../../../../../../../../pkg/github.com/go-git/go-git/v5/plumbing/protocol/packp/capability.html#name-DefaultAgent" class="ident">DefaultAgent</a> = <span class="lit-string">"go-git/4.x"</span>

<span class="keyword">var</span> <a href="../../../../../../../../../pkg/github.com/go-git/go-git/v5/plumbing/protocol/packp/capability.html#name-known" class="ident">known</a> = <span class="keyword">map</span>[<a href="#line-5" class="ident">Capability</a>]<a href="../../../../../../../../../pkg/builtin.html#name-bool" class="ident">bool</a>{
	<a href="#line-49" class="ident">MultiACK</a>: <a href="../../../../../../../../../pkg/builtin.html#name-true" class="ident">true</a>, <a href="#line-52" class="ident">MultiACKDetailed</a>: <a href="../../../../../../../../../pkg/builtin.html#name-true" class="ident">true</a>, <a href="#line-62" class="ident">NoDone</a>: <a href="../../../../../../../../../pkg/builtin.html#name-true" class="ident">true</a>, <a href="#line-86" class="ident">ThinPack</a>: <a href="../../../../../../../../../pkg/builtin.html#name-true" class="ident">true</a>,
	<a href="#line-118" class="ident">Sideband</a>: <a href="../../../../../../../../../pkg/builtin.html#name-true" class="ident">true</a>, <a href="#line-119" class="ident">Sideband64k</a>: <a href="../../../../../../../../../pkg/builtin.html#name-true" class="ident">true</a>, <a href="#line-123" class="ident">OFSDelta</a>: <a href="../../../../../../../../../pkg/builtin.html#name-true" class="ident">true</a>, <a href="#line-133" class="ident">Agent</a>: <a href="../../../../../../../../../pkg/builtin.html#name-true" class="ident">true</a>,
	<a href="#line-137" class="ident">Shallow</a>: <a href="../../../../../../../../../pkg/builtin.html#name-true" class="ident">true</a>, <a href="#line-143" class="ident">DeepenSince</a>: <a href="../../../../../../../../../pkg/builtin.html#name-true" class="ident">true</a>, <a href="#line-149" class="ident">DeepenNot</a>: <a href="../../../../../../../../../pkg/builtin.html#name-true" class="ident">true</a>, <a href="#line-154" class="ident">DeepenRelative</a>: <a href="../../../../../../../../../pkg/builtin.html#name-true" class="ident">true</a>,
	<a href="#line-160" class="ident">NoProgress</a>: <a href="../../../../../../../../../pkg/builtin.html#name-true" class="ident">true</a>, <a href="#line-183" class="ident">IncludeTag</a>: <a href="../../../../../../../../../pkg/builtin.html#name-true" class="ident">true</a>, <a href="#line-192" class="ident">ReportStatus</a>: <a href="../../../../../../../../../pkg/builtin.html#name-true" class="ident">true</a>, <a href="#line-198" class="ident">DeleteRefs</a>: <a href="../../../../../../../../../pkg/builtin.html#name-true" class="ident">true</a>,
	<a href="#line-205" class="ident">Quiet</a>: <a href="../../../../../../../../../pkg/builtin.html#name-true" class="ident">true</a>, <a href="#line-210" class="ident">Atomic</a>: <a href="../../../../../../../../../pkg/builtin.html#name-true" class="ident">true</a>, <a href="#line-216" class="ident">PushOptions</a>: <a href="../../../../../../../../../pkg/builtin.html#name-true" class="ident">true</a>, <a href="#line-220" class="ident">AllowTipSHA1InWant</a>: <a href="../../../../../../../../../pkg/builtin.html#name-true" class="ident">true</a>,
	<a href="#line-224" class="ident">AllowReachableSHA1InWant</a>: <a href="../../../../../../../../../pkg/builtin.html#name-true" class="ident">true</a>, <a href="#line-230" class="ident">PushCert</a>: <a href="../../../../../../../../../pkg/builtin.html#name-true" class="ident">true</a>, <a href="#line-232" class="ident">SymRef</a>: <a href="../../../../../../../../../pkg/builtin.html#name-true" class="ident">true</a>,
}

<span class="keyword">var</span> <a href="../../../../../../../../../pkg/github.com/go-git/go-git/v5/plumbing/protocol/packp/capability.html#name-requiresArgument" class="ident">requiresArgument</a> = <span class="keyword">map</span>[<a href="#line-5" class="ident">Capability</a>]<a href="../../../../../../../../../pkg/builtin.html#name-bool" class="ident">bool</a>{
	<a href="#line-133" class="ident">Agent</a>: <a href="../../../../../../../../../pkg/builtin.html#name-true" class="ident">true</a>, <a href="#line-230" class="ident">PushCert</a>: <a href="../../../../../../../../../pkg/builtin.html#name-true" class="ident">true</a>, <a href="#line-232" class="ident">SymRef</a>: <a href="../../../../../../../../../pkg/builtin.html#name-true" class="ident">true</a>,
}

<span class="keyword">var</span> <a href="../../../../../../../../../pkg/github.com/go-git/go-git/v5/plumbing/protocol/packp/capability.html#name-multipleArgument" class="ident">multipleArgument</a> = <span class="keyword">map</span>[<a href="#line-5" class="ident">Capability</a>]<a href="../../../../../../../../../pkg/builtin.html#name-bool" class="ident">bool</a>{
	<a href="#line-232" class="ident">SymRef</a>: <a href="../../../../../../../../../pkg/builtin.html#name-true" class="ident">true</a>,
</code></pre></div></div>

</div><pre id="footer">
<table><tr><td><img src="../../../../../../../../../png/go101-twitter.png"></td>
<td>The pages are generated with <a href="https://go101.org/article/tool-golds.html"><b>Golds</b></a> <i>v0.3.2-preview</i>. (GOOS=darwin GOARCH=amd64)
<b>Golds</b> is a <a href="https://go101.org">Go 101</a> project developed by <a href="https://tapirgames.com">Tapir Liu</a>.
PR and bug reports are welcome and can be submitted to <a href="https://github.com/go101/golds">the issue list</a>.
Please follow <a href="https://twitter.com/go100and1">@Go100and1</a> (reachable from the left QR code) to get the latest news of <b>Golds</b>.</td></tr></table></pre>