<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Source: sniff.go in package net/http</title>
<link href="../../../css/lightLiterate-v0.3.2-preview.css" rel="stylesheet">
<script src="../../../jvs/golds-v0.3.2-preview.js"></script>
<body onload="onPageLoad()"><div>

<pre id="header"><code><span class="title">Source File</span>
	sniff.go

<span class="title">Belonging Package</span>
	<a href="../../../pkg/net/http.html">net/http</a>
</code></pre>
<style>input[type=radio] {display: none;}
input[id=r0]:checked ~pre label[for=r0],
input[id=r1]:checked ~pre label[for=r1],
input[id=r2]:checked ~pre label[for=r2],
input[id=r3]:checked ~pre label[for=r3],
input[id=r4]:checked ~pre label[for=r4],
input[id=r5]:checked ~pre label[for=r5],
input[id=r6]:checked ~pre label[for=r6],
input[id=r7]:checked ~pre label[for=r7],
input[id=r8]:checked ~pre label[for=r8],
input[id=r9]:checked ~pre label[for=r9],
input[id=r10]:checked ~pre label[for=r10],
input[id=r11]:checked ~pre label[for=r11],
input[id=r12]:checked ~pre label[for=r12],
input[id=r13]:checked ~pre label[for=r13],
input[id=r14]:checked ~pre label[for=r14],
input[id=r15]:checked ~pre label[for=r15],
input[id=r16]:checked ~pre label[for=r16],
input[id=r17]:checked ~pre label[for=r17],
input[id=r18]:checked ~pre label[for=r18],
input[id=r19]:checked ~pre label[for=r19],
input[id=r20]:checked ~pre label[for=r20],
input[id=r21]:checked ~pre label[for=r21],
input[id=r22]:checked ~pre label[for=r22],
input[id=r23]:checked ~pre label[for=r23],
input[id=r24]:checked ~pre label[for=r24],
input[id=r25]:checked ~pre label[for=r25],
input[id=r26]:checked ~pre label[for=r26],
input[id=r27]:checked ~pre label[for=r27],
input[id=r28]:checked ~pre label[for=r28],
input[id=r29]:checked ~pre label[for=r29],
input[id=r30]:checked ~pre label[for=r30],
input[id=r31]:checked ~pre label[for=r31],
input[id=r32]:checked ~pre label[for=r32],
input[id=r33]:checked ~pre label[for=r33],
input[id=r34]:checked ~pre label[for=r34],
input[id=r35]:checked ~pre label[for=r35],
input[id=r36]:checked ~pre label[for=r36],
input[id=r37]:checked ~pre label[for=r37]
{background: #226; color: #ff8;}
input[id=i0]:checked ~pre .i0,
input[id=i1]:checked ~pre .i1
{background: brown; color: #eed;}
</style><input id="r0" type="radio" name="g"/>
<input id="r1" type="radio" name="g"/>
<input id="r2" type="radio" name="g"/>
<input id="r3" type="radio" name="g"/>
<input id="r4" type="radio" name="g"/>
<input id="r5" type="radio" name="g"/>
<input id="r6" type="radio" name="g"/>
<input id="r7" type="radio" name="g"/>
<input id="r8" type="radio" name="g"/>
<input id="r9" type="radio" name="g"/>
<input id="r10" type="radio" name="g"/>
<input id="r11" type="radio" name="g"/>
<input id="r12" type="radio" name="g"/>
<input id="r13" type="radio" name="g"/>
<input id="r14" type="radio" name="g"/>
<input id="r15" type="radio" name="g"/>
<input id="r16" type="radio" name="g"/>
<input id="r17" type="radio" name="g"/>
<input id="r18" type="radio" name="g"/>
<input id="r19" type="radio" name="g"/>
<input id="r20" type="radio" name="g"/>
<input id="r21" type="radio" name="g"/>
<input id="r22" type="radio" name="g"/>
<input id="r23" type="radio" name="g"/>
<input id="r24" type="radio" name="g"/>
<input id="r25" type="radio" name="g"/>
<input id="r26" type="radio" name="g"/>
<input id="r27" type="radio" name="g"/>
<input id="r28" type="radio" name="g"/>
<input id="r29" type="radio" name="g"/>
<input id="r30" type="radio" name="g"/>
<input id="r31" type="radio" name="g"/>
<input id="r32" type="radio" name="g"/>
<input id="r33" type="radio" name="g"/>
<input id="r34" type="radio" name="g"/>
<input id="r35" type="radio" name="g"/>
<input id="r36" type="radio" name="g"/>
<input id="r37" type="radio" name="g"/>
<input id="i0" type="radio" name="i"/>
<input id="i1" type="radio" name="i"/>
<div id="container"><div class="section">
<div class="doc">
<span class="comment"> Copyright 2011 The Go Authors. All rights reserved.</span><span class="comment"> Use of this source code is governed by a BSD-style</span><span class="comment"> license that can be found in the LICENSE file.</span></div>
<div class="code"><pre><code>
<span class="keyword">package</span> http

<span class="keyword">import</span> (
	<label for="i0"><span class="lit-string i0">"bytes"</span></label>
	<label for="i1"><span class="lit-string i1">"encoding/binary"</span></label>
)
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> The algorithm uses at most sniffLen bytes to make its decision.</span></div>
<div class="code"><pre><code><span class="keyword">const</span> <a href="../../../pkg/net/http.html#name-sniffLen" class="ident">sniffLen</a> = <span class="lit-number">512</span>
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> DetectContentType implements the algorithm described</span><span class="comment"> at https://mimesniff.spec.whatwg.org/ to determine the</span><span class="comment"> Content-Type of the given data. It considers at most the</span><span class="comment"> first 512 bytes of data. DetectContentType always returns</span><span class="comment"> a valid MIME type: if it cannot determine a more specific one, it</span><span class="comment"> returns "application/octet-stream".</span></div>
<div class="code"><pre><code><span class="keyword">func</span> <label for="r0" class="ident"><a href="../../../pkg/net/http.html#name-DetectContentType" class="ident">DetectContentType</a></label>(<label for="r1" class="ident">data</label> []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>) <a href="../../../pkg/builtin.html#name-string" class="ident">string</a> {
	<span class="keyword">if</span> <a href="../../../pkg/builtin.html#name-len" class="ident">len</a>(<label for="r1" class="ident">data</label>) &gt; <a href="#line-13" class="ident">sniffLen</a> {
		<label for="r1" class="ident">data</label> = <label for="r1" class="ident">data</label>[:<a href="#line-13" class="ident">sniffLen</a>]
	}
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> Index of the first non-whitespace byte in data.</span></div>
<div class="code"><pre><code>	<label for="r2" class="ident">firstNonWS</label> := <span class="lit-number">0</span>
	<span class="keyword">for</span> ; <label for="r2" class="ident">firstNonWS</label> &lt; <a href="../../../pkg/builtin.html#name-len" class="ident">len</a>(<label for="r1" class="ident">data</label>) &amp;&amp; <a href="#line-42" class="ident">isWS</a>(<label for="r1" class="ident">data</label>[<label for="r2" class="ident">firstNonWS</label>]); <label for="r2" class="ident">firstNonWS</label>++ {
	}

	<span class="keyword">for</span> <label for="r3" class="ident">_</label>, <label for="r4" class="ident">sig</label> := <span class="keyword">range</span> <a href="#line-66" class="ident">sniffSignatures</a> {
		<span class="keyword">if</span> <label for="r5" class="ident">ct</label> := <label for="r4" class="ident">sig</label>.<a href="#line-62" class="ident">match</a>(<label for="r1" class="ident">data</label>, <label for="r2" class="ident">firstNonWS</label>); <label for="r5" class="ident">ct</label> != <span class="lit-string">""</span> {
			<span class="keyword">return</span> <label for="r5" class="ident">ct</label>
		}
	}

	<span class="keyword">return</span> <span class="lit-string">"application/octet-stream"</span> <span class="comment">// fallback</span>
}
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> isWS reports whether the provided byte is a whitespace byte (0xWS)</span><span class="comment"> as defined in https://mimesniff.spec.whatwg.org/#terminology.</span></div>
<div class="code"><pre><code><span class="keyword">func</span> <label for="r6" class="ident"><a href="../../../pkg/net/http.html#name-isWS" class="ident">isWS</a></label>(<label for="r7" class="ident">b</label> <a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>) <a href="../../../pkg/builtin.html#name-bool" class="ident">bool</a> {
	<span class="keyword">switch</span> <label for="r7" class="ident">b</label> {
	<span class="keyword">case</span> <span class="lit-number">'\t'</span>, <span class="lit-number">'\n'</span>, <span class="lit-number">'\x0c'</span>, <span class="lit-number">'\r'</span>, <span class="lit-number">' '</span>:
		<span class="keyword">return</span> <a href="../../../pkg/builtin.html#name-true" class="ident">true</a>
	}
	<span class="keyword">return</span> <a href="../../../pkg/builtin.html#name-false" class="ident">false</a>
}
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> isTT reports whether the provided byte is a tag-terminating byte (0xTT)</span><span class="comment"> as defined in https://mimesniff.spec.whatwg.org/#terminology.</span></div>
<div class="code"><pre><code><span class="keyword">func</span> <label for="r8" class="ident"><a href="../../../pkg/net/http.html#name-isTT" class="ident">isTT</a></label>(<label for="r9" class="ident">b</label> <a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>) <a href="../../../pkg/builtin.html#name-bool" class="ident">bool</a> {
	<span class="keyword">switch</span> <label for="r9" class="ident">b</label> {
	<span class="keyword">case</span> <span class="lit-number">' '</span>, <span class="lit-number">'&gt;'</span>:
		<span class="keyword">return</span> <a href="../../../pkg/builtin.html#name-true" class="ident">true</a>
	}
	<span class="keyword">return</span> <a href="../../../pkg/builtin.html#name-false" class="ident">false</a>
}

</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> match returns the MIME type of the data, or "" if unknown.</span></div>
<div class="code"><pre><code>	match(data []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>, firstNonWS <a href="../../../pkg/builtin.html#name-int" class="ident">int</a>) <a href="../../../pkg/builtin.html#name-string" class="ident">string</a>
}
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> Data matching the table in section 6.</span></div>
<div class="code"><pre><code><span class="keyword">var</span> <a href="../../../pkg/net/http.html#name-sniffSignatures" class="ident">sniffSignatures</a> = []<a href="#line-60" class="ident">sniffSig</a>{
	<a href="#line-242" class="ident">htmlSig</a>(<span class="lit-string">"&lt;!DOCTYPE HTML"</span>),
	<a href="#line-242" class="ident">htmlSig</a>(<span class="lit-string">"&lt;HTML"</span>),
	<a href="#line-242" class="ident">htmlSig</a>(<span class="lit-string">"&lt;HEAD"</span>),
	<a href="#line-242" class="ident">htmlSig</a>(<span class="lit-string">"&lt;SCRIPT"</span>),
	<a href="#line-242" class="ident">htmlSig</a>(<span class="lit-string">"&lt;IFRAME"</span>),
	<a href="#line-242" class="ident">htmlSig</a>(<span class="lit-string">"&lt;H1"</span>),
	<a href="#line-242" class="ident">htmlSig</a>(<span class="lit-string">"&lt;DIV"</span>),
	<a href="#line-242" class="ident">htmlSig</a>(<span class="lit-string">"&lt;FONT"</span>),
	<a href="#line-242" class="ident">htmlSig</a>(<span class="lit-string">"&lt;TABLE"</span>),
	<a href="#line-242" class="ident">htmlSig</a>(<span class="lit-string">"&lt;A"</span>),
	<a href="#line-242" class="ident">htmlSig</a>(<span class="lit-string">"&lt;STYLE"</span>),
	<a href="#line-242" class="ident">htmlSig</a>(<span class="lit-string">"&lt;TITLE"</span>),
	<a href="#line-242" class="ident">htmlSig</a>(<span class="lit-string">"&lt;B"</span>),
	<a href="#line-242" class="ident">htmlSig</a>(<span class="lit-string">"&lt;BODY"</span>),
	<a href="#line-242" class="ident">htmlSig</a>(<span class="lit-string">"&lt;BR"</span>),
	<a href="#line-242" class="ident">htmlSig</a>(<span class="lit-string">"&lt;P"</span>),
	<a href="#line-242" class="ident">htmlSig</a>(<span class="lit-string">"&lt;!--"</span>),
	&amp;<a href="#line-214" class="ident">maskedSig</a>{
		<a href="#line-215" class="ident">mask</a>:   []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"\xFF\xFF\xFF\xFF\xFF"</span>),
		<a href="#line-215" class="ident">pat</a>:    []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"&lt;?xml"</span>),
		<a href="#line-216" class="ident">skipWS</a>: <a href="../../../pkg/builtin.html#name-true" class="ident">true</a>,
		<a href="#line-217" class="ident">ct</a>:     <span class="lit-string">"text/xml; charset=utf-8"</span>},
	&amp;<a href="#line-202" class="ident">exactSig</a>{[]<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"%PDF-"</span>), <span class="lit-string">"application/pdf"</span>},
	&amp;<a href="#line-202" class="ident">exactSig</a>{[]<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"%!PS-Adobe-"</span>), <span class="lit-string">"application/postscript"</span>},
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> UTF BOMs.</span></div>
<div class="code"><pre><code>	&amp;<a href="#line-214" class="ident">maskedSig</a>{
		<a href="#line-215" class="ident">mask</a>: []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"\xFF\xFF\x00\x00"</span>),
		<a href="#line-215" class="ident">pat</a>:  []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"\xFE\xFF\x00\x00"</span>),
		<a href="#line-217" class="ident">ct</a>:   <span class="lit-string">"text/plain; charset=utf-16be"</span>,
	},
	&amp;<a href="#line-214" class="ident">maskedSig</a>{
		<a href="#line-215" class="ident">mask</a>: []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"\xFF\xFF\x00\x00"</span>),
		<a href="#line-215" class="ident">pat</a>:  []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"\xFF\xFE\x00\x00"</span>),
		<a href="#line-217" class="ident">ct</a>:   <span class="lit-string">"text/plain; charset=utf-16le"</span>,
	},
	&amp;<a href="#line-214" class="ident">maskedSig</a>{
		<a href="#line-215" class="ident">mask</a>: []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"\xFF\xFF\xFF\x00"</span>),
		<a href="#line-215" class="ident">pat</a>:  []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"\xEF\xBB\xBF\x00"</span>),
		<a href="#line-217" class="ident">ct</a>:   <span class="lit-string">"text/plain; charset=utf-8"</span>,
	},
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> Image types</span><span class="comment">	 For posterity, we originally returned "image/vnd.microsoft.icon" from</span><span class="comment">	 https://tools.ietf.org/html/draft-ietf-websec-mime-sniff-03#section-7</span><span class="comment">	 https://codereview.appspot.com/4746042</span><span class="comment">	 but that has since been replaced with "image/x-icon" in Section 6.2</span><span class="comment">	 of https://mimesniff.spec.whatwg.org/#matching-an-image-type-pattern</span></div>
<div class="code"><pre><code>	&amp;<a href="#line-202" class="ident">exactSig</a>{[]<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"\x00\x00\x01\x00"</span>), <span class="lit-string">"image/x-icon"</span>},
	&amp;<a href="#line-202" class="ident">exactSig</a>{[]<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"\x00\x00\x02\x00"</span>), <span class="lit-string">"image/x-icon"</span>},
	&amp;<a href="#line-202" class="ident">exactSig</a>{[]<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"BM"</span>), <span class="lit-string">"image/bmp"</span>},
	&amp;<a href="#line-202" class="ident">exactSig</a>{[]<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"GIF87a"</span>), <span class="lit-string">"image/gif"</span>},
	&amp;<a href="#line-202" class="ident">exactSig</a>{[]<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"GIF89a"</span>), <span class="lit-string">"image/gif"</span>},
	&amp;<a href="#line-214" class="ident">maskedSig</a>{
		<a href="#line-215" class="ident">mask</a>: []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"\xFF\xFF\xFF\xFF\x00\x00\x00\x00\xFF\xFF\xFF\xFF\xFF\xFF"</span>),
		<a href="#line-215" class="ident">pat</a>:  []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"RIFF\x00\x00\x00\x00WEBPVP"</span>),
		<a href="#line-217" class="ident">ct</a>:   <span class="lit-string">"image/webp"</span>,
	},
	&amp;<a href="#line-202" class="ident">exactSig</a>{[]<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"\x89PNG\x0D\x0A\x1A\x0A"</span>), <span class="lit-string">"image/png"</span>},
	&amp;<a href="#line-202" class="ident">exactSig</a>{[]<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"\xFF\xD8\xFF"</span>), <span class="lit-string">"image/jpeg"</span>},
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> Audio and Video types</span><span class="comment">	 Enforce the pattern match ordering as prescribed in</span><span class="comment">	 https://mimesniff.spec.whatwg.org/#matching-an-audio-or-video-type-pattern</span></div>
<div class="code"><pre><code>	&amp;<a href="#line-214" class="ident">maskedSig</a>{
		<a href="#line-215" class="ident">mask</a>: []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"\xFF\xFF\xFF\xFF"</span>),
		<a href="#line-215" class="ident">pat</a>:  []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">".snd"</span>),
		<a href="#line-217" class="ident">ct</a>:   <span class="lit-string">"audio/basic"</span>,
	},
	&amp;<a href="#line-214" class="ident">maskedSig</a>{
		<a href="#line-215" class="ident">mask</a>: []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"\xFF\xFF\xFF\xFF\x00\x00\x00\x00\xFF\xFF\xFF\xFF"</span>),
		<a href="#line-215" class="ident">pat</a>:  []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"FORM\x00\x00\x00\x00AIFF"</span>),
		<a href="#line-217" class="ident">ct</a>:   <span class="lit-string">"audio/aiff"</span>,
	},
	&amp;<a href="#line-214" class="ident">maskedSig</a>{
		<a href="#line-215" class="ident">mask</a>: []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"\xFF\xFF\xFF"</span>),
		<a href="#line-215" class="ident">pat</a>:  []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"ID3"</span>),
		<a href="#line-217" class="ident">ct</a>:   <span class="lit-string">"audio/mpeg"</span>,
	},
	&amp;<a href="#line-214" class="ident">maskedSig</a>{
		<a href="#line-215" class="ident">mask</a>: []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"\xFF\xFF\xFF\xFF\xFF"</span>),
		<a href="#line-215" class="ident">pat</a>:  []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"OggS\x00"</span>),
		<a href="#line-217" class="ident">ct</a>:   <span class="lit-string">"application/ogg"</span>,
	},
	&amp;<a href="#line-214" class="ident">maskedSig</a>{
		<a href="#line-215" class="ident">mask</a>: []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF"</span>),
		<a href="#line-215" class="ident">pat</a>:  []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"MThd\x00\x00\x00\x06"</span>),
		<a href="#line-217" class="ident">ct</a>:   <span class="lit-string">"audio/midi"</span>,
	},
	&amp;<a href="#line-214" class="ident">maskedSig</a>{
		<a href="#line-215" class="ident">mask</a>: []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"\xFF\xFF\xFF\xFF\x00\x00\x00\x00\xFF\xFF\xFF\xFF"</span>),
		<a href="#line-215" class="ident">pat</a>:  []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"RIFF\x00\x00\x00\x00AVI "</span>),
		<a href="#line-217" class="ident">ct</a>:   <span class="lit-string">"video/avi"</span>,
	},
	&amp;<a href="#line-214" class="ident">maskedSig</a>{
		<a href="#line-215" class="ident">mask</a>: []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"\xFF\xFF\xFF\xFF\x00\x00\x00\x00\xFF\xFF\xFF\xFF"</span>),
		<a href="#line-215" class="ident">pat</a>:  []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"RIFF\x00\x00\x00\x00WAVE"</span>),
		<a href="#line-217" class="ident">ct</a>:   <span class="lit-string">"audio/wave"</span>,
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> 6.2.0.2. video/mp4</span></div>
<div class="code"><pre><code></code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> 6.2.0.3. video/webm</span></div>
<div class="code"><pre><code>	&amp;<a href="#line-202" class="ident">exactSig</a>{[]<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"\x1A\x45\xDF\xA3"</span>), <span class="lit-string">"video/webm"</span>},
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> Font types</span></div>
<div class="code"><pre><code></code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> 34 NULL bytes followed by the string "LP"</span></div>
<div class="code"><pre><code></code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> 34 NULL bytes followed by \xF\xF</span></div>
<div class="code"><pre><code>		<a href="#line-215" class="ident">mask</a>: []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xFF\xFF"</span>),
		<a href="#line-217" class="ident">ct</a>:   <span class="lit-string">"application/vnd.ms-fontobject"</span>,
	},
	&amp;<a href="#line-202" class="ident">exactSig</a>{[]<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"\x00\x01\x00\x00"</span>), <span class="lit-string">"font/ttf"</span>},
	&amp;<a href="#line-202" class="ident">exactSig</a>{[]<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"OTTO"</span>), <span class="lit-string">"font/otf"</span>},
	&amp;<a href="#line-202" class="ident">exactSig</a>{[]<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"ttcf"</span>), <span class="lit-string">"font/collection"</span>},
	&amp;<a href="#line-202" class="ident">exactSig</a>{[]<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"wOFF"</span>), <span class="lit-string">"font/woff"</span>},
	&amp;<a href="#line-202" class="ident">exactSig</a>{[]<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"wOF2"</span>), <span class="lit-string">"font/woff2"</span>},
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> Archive types</span></div>
<div class="code"><pre><code>	&amp;<a href="#line-202" class="ident">exactSig</a>{[]<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"\x1F\x8B\x08"</span>), <span class="lit-string">"application/x-gzip"</span>},
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> RAR's signatures are incorrectly defined by the MIME spec as per</span><span class="comment">	    https://github.com/whatwg/mimesniff/issues/63</span><span class="comment">	 However, RAR Labs correctly defines it at:</span><span class="comment">	    https://www.rarlab.com/technote.htm#rarsign</span><span class="comment">	 so we use the definition from RAR Labs.</span><span class="comment">	 TODO: do whatever the spec ends up doing.</span></div>
<div class="code"><pre><code>	&amp;<a href="#line-202" class="ident">exactSig</a>{[]<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"Rar!\x1A\x07\x00"</span>), <span class="lit-string">"application/x-rar-compressed"</span>},     <span class="comment">// RAR v1.5-v4.0</span>
	&amp;<a href="#line-202" class="ident">exactSig</a>{[]<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"Rar!\x1A\x07\x01\x00"</span>), <span class="lit-string">"application/x-rar-compressed"</span>}, <span class="comment">// RAR v5+</span>

	&amp;<a href="#line-202" class="ident">exactSig</a>{[]<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"\x00\x61\x73\x6D"</span>), <span class="lit-string">"application/wasm"</span>},

	<a href="#line-295" class="ident">textSig</a>{}, <span class="comment">// should be last</span>
}

<span class="keyword">type</span> <a href="../../../pkg/net/http.html#name-exactSig" class="ident">exactSig</a> <span class="keyword">struct</span> {
	<a href="../../../use/net/http..exactSig*517d1.sig*a5439.html" class="ident">sig</a> []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>
	<a href="../../../use/net/http..exactSig*517d1.ct*f8dcb.html" class="ident">ct</a>  <a href="../../../pkg/builtin.html#name-string" class="ident">string</a>
}

<span class="keyword">func</span> (<label for="r10" class="ident">e</label> *<a href="#line-202" class="ident">exactSig</a>) <label for="r11" class="ident"><a href="../../../use/net/http..exactSig*517d1.match*4945a.html" class="ident">match</a></label>(<label for="r12" class="ident">data</label> []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>, <label for="r13" class="ident">firstNonWS</label> <a href="../../../pkg/builtin.html#name-int" class="ident">int</a>) <a href="../../../pkg/builtin.html#name-string" class="ident">string</a> {
	<span class="keyword">if</span> <a href="../../../pkg/bytes.html" class="ident i0">bytes</a>.<a href="../../bytes/bytes.go.html#line-537" class="ident">HasPrefix</a>(<label for="r12" class="ident">data</label>, <label for="r10" class="ident">e</label>.<a href="#line-203" class="ident">sig</a>) {
		<span class="keyword">return</span> <label for="r10" class="ident">e</label>.<a href="#line-204" class="ident">ct</a>
	}
	<span class="keyword">return</span> <span class="lit-string">""</span>
}

<span class="keyword">type</span> <a href="../../../pkg/net/http.html#name-maskedSig" class="ident">maskedSig</a> <span class="keyword">struct</span> {
	<a href="../../../use/net/http..maskedSig*99437.mask*48bf9.html" class="ident">mask</a>, <a href="../../../use/net/http..maskedSig*99437.pat*68d75.html" class="ident">pat</a> []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>
	<a href="../../../use/net/http..maskedSig*99437.skipWS*34fa9.html" class="ident">skipWS</a>    <a href="../../../pkg/builtin.html#name-bool" class="ident">bool</a>
	<a href="../../../use/net/http..maskedSig*99437.ct*f8dcb.html" class="ident">ct</a>        <a href="../../../pkg/builtin.html#name-string" class="ident">string</a>
}

</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> pattern matching algorithm section 6</span><span class="comment">	 https://mimesniff.spec.whatwg.org/#pattern-matching-algorithm</span></div>
<div class="code"><pre><code>
	<span class="keyword">if</span> <label for="r14" class="ident">m</label>.<a href="#line-216" class="ident">skipWS</a> {
		<label for="r16" class="ident">data</label> = <label for="r16" class="ident">data</label>[<label for="r17" class="ident">firstNonWS</label>:]
	}
	<span class="keyword">if</span> <a href="../../../pkg/builtin.html#name-len" class="ident">len</a>(<label for="r14" class="ident">m</label>.<a href="#line-215" class="ident">pat</a>) != <a href="../../../pkg/builtin.html#name-len" class="ident">len</a>(<label for="r14" class="ident">m</label>.<a href="#line-215" class="ident">mask</a>) {
		<span class="keyword">return</span> <span class="lit-string">""</span>
	}
	<span class="keyword">if</span> <a href="../../../pkg/builtin.html#name-len" class="ident">len</a>(<label for="r16" class="ident">data</label>) &lt; <a href="../../../pkg/builtin.html#name-len" class="ident">len</a>(<label for="r14" class="ident">m</label>.<a href="#line-215" class="ident">pat</a>) {
		<span class="keyword">return</span> <span class="lit-string">""</span>
	}
	<span class="keyword">for</span> <label for="r18" class="ident">i</label>, <label for="r19" class="ident">pb</label> := <span class="keyword">range</span> <label for="r14" class="ident">m</label>.<a href="#line-215" class="ident">pat</a> {
		<label for="r20" class="ident">maskedData</label> := <label for="r16" class="ident">data</label>[<label for="r18" class="ident">i</label>] &amp; <label for="r14" class="ident">m</label>.<a href="#line-215" class="ident">mask</a>[<label for="r18" class="ident">i</label>]
		<span class="keyword">if</span> <label for="r20" class="ident">maskedData</label> != <label for="r19" class="ident">pb</label> {
			<span class="keyword">return</span> <span class="lit-string">""</span>
		}
	}
	<span class="keyword">return</span> <label for="r14" class="ident">m</label>.<a href="#line-217" class="ident">ct</a>
}

<span class="keyword">type</span> <a href="../../../pkg/net/http.html#name-htmlSig" class="ident">htmlSig</a> []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>

<span class="keyword">func</span> (<label for="r21" class="ident">h</label> <a href="#line-242" class="ident">htmlSig</a>) <label for="r22" class="ident"><a href="../../../use/net/http..htmlSig*17a04.match*4945a.html" class="ident">match</a></label>(<label for="r23" class="ident">data</label> []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>, <label for="r24" class="ident">firstNonWS</label> <a href="../../../pkg/builtin.html#name-int" class="ident">int</a>) <a href="../../../pkg/builtin.html#name-string" class="ident">string</a> {
	<label for="r23" class="ident">data</label> = <label for="r23" class="ident">data</label>[<label for="r24" class="ident">firstNonWS</label>:]
	<span class="keyword">if</span> <a href="../../../pkg/builtin.html#name-len" class="ident">len</a>(<label for="r23" class="ident">data</label>) &lt; <a href="../../../pkg/builtin.html#name-len" class="ident">len</a>(<label for="r21" class="ident">h</label>)+<span class="lit-number">1</span> {
		<span class="keyword">return</span> <span class="lit-string">""</span>
	}
	<span class="keyword">for</span> <label for="r25" class="ident">i</label>, <label for="r26" class="ident">b</label> := <span class="keyword">range</span> <label for="r21" class="ident">h</label> {
		<label for="r27" class="ident">db</label> := <label for="r23" class="ident">data</label>[<label for="r25" class="ident">i</label>]
		<span class="keyword">if</span> <span class="lit-number">'A'</span> &lt;= <label for="r26" class="ident">b</label> &amp;&amp; <label for="r26" class="ident">b</label> &lt;= <span class="lit-number">'Z'</span> {
			<label for="r27" class="ident">db</label> &amp;= <span class="lit-number">0xDF</span>
		}
		<span class="keyword">if</span> <label for="r26" class="ident">b</label> != <label for="r27" class="ident">db</label> {
			<span class="keyword">return</span> <span class="lit-string">""</span>
		}
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> Next byte must be a tag-terminating byte(0xTT).</span></div>
<div class="code"><pre><code>	<span class="keyword">if</span> !<a href="#line-52" class="ident">isTT</a>(<label for="r23" class="ident">data</label>[<a href="../../../pkg/builtin.html#name-len" class="ident">len</a>(<label for="r21" class="ident">h</label>)]) {
		<span class="keyword">return</span> <span class="lit-string">""</span>
	}
	<span class="keyword">return</span> <span class="lit-string">"text/html; charset=utf-8"</span>
}

<span class="keyword">var</span> <a href="../../../pkg/net/http.html#name-mp4ftype" class="ident">mp4ftype</a> = []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"ftyp"</span>)
<span class="keyword">var</span> <a href="../../../pkg/net/http.html#name-mp4" class="ident">mp4</a> = []<a href="../../../pkg/builtin.html#name-byte" class="ident">byte</a>(<span class="lit-string">"mp4"</span>)

<span class="keyword">type</span> <a href="../../../pkg/net/http.html#name-mp4Sig" class="ident">mp4Sig</a> <span class="keyword">struct</span>{}

</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> https://mimesniff.spec.whatwg.org/#signature-for-mp4</span><span class="comment">	 c.f. section 6.2.1</span></div>
<div class="code"><pre><code>	<span class="keyword">if</span> <a href="../../../pkg/builtin.html#name-len" class="ident">len</a>(<label for="r29" class="ident">data</label>) &lt; <span class="lit-number">12</span> {
		<span class="keyword">return</span> <span class="lit-string">""</span>
	}
	<label for="r31" class="ident">boxSize</label> := <a href="../../../pkg/builtin.html#name-int" class="ident">int</a>(<a href="../../../pkg/encoding/binary.html" class="ident i1">binary</a>.<a href="../../encoding/binary/binary.go.html#line-48" class="ident">BigEndian</a>.<a href="../../encoding/binary/binary.go.html#line-111" class="ident">Uint32</a>(<label for="r29" class="ident">data</label>[:<span class="lit-number">4</span>]))
	<span class="keyword">if</span> <a href="../../../pkg/builtin.html#name-len" class="ident">len</a>(<label for="r29" class="ident">data</label>) &lt; <label for="r31" class="ident">boxSize</label> || <label for="r31" class="ident">boxSize</label>%<span class="lit-number">4</span> != <span class="lit-number">0</span> {
		<span class="keyword">return</span> <span class="lit-string">""</span>
	}
	<span class="keyword">if</span> !<a href="../../../pkg/bytes.html" class="ident i0">bytes</a>.<a href="../../bytes/bytes.go.html#line-18" class="ident">Equal</a>(<label for="r29" class="ident">data</label>[<span class="lit-number">4</span>:<span class="lit-number">8</span>], <a href="#line-265" class="ident">mp4ftype</a>) {
		<span class="keyword">return</span> <span class="lit-string">""</span>
	}
	<span class="keyword">for</span> <label for="r32" class="ident">st</label> := <span class="lit-number">8</span>; <label for="r32" class="ident">st</label> &lt; <label for="r31" class="ident">boxSize</label>; <label for="r32" class="ident">st</label> += <span class="lit-number">4</span> {
</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> Ignores the four bytes that correspond to the version number of the "major brand".</span></div>
<div class="code"><pre><code>			<span class="keyword">continue</span>
		}
		<span class="keyword">if</span> <a href="../../../pkg/bytes.html" class="ident i0">bytes</a>.<a href="../../bytes/bytes.go.html#line-18" class="ident">Equal</a>(<label for="r29" class="ident">data</label>[<label for="r32" class="ident">st</label>:<label for="r32" class="ident">st</label>+<span class="lit-number">3</span>], <a href="#line-266" class="ident">mp4</a>) {
			<span class="keyword">return</span> <span class="lit-string">"video/mp4"</span>
		}
	}
	<span class="keyword">return</span> <span class="lit-string">""</span>
}

<span class="keyword">type</span> <a href="../../../pkg/net/http.html#name-textSig" class="ident">textSig</a> <span class="keyword">struct</span>{}

</code></pre></div></div>
<div class="section">
<div class="doc">
<span class="comment"> c.f. section 5, step 4.</span></div>
<div class="code"><pre><code>	<span class="keyword">for</span> <label for="r36" class="ident">_</label>, <label for="r37" class="ident">b</label> := <span class="keyword">range</span> <label for="r34" class="ident">data</label>[<label for="r35" class="ident">firstNonWS</label>:] {
		<span class="keyword">switch</span> {
		<span class="keyword">case</span> <label for="r37" class="ident">b</label> &lt;= <span class="lit-number">0x08</span>,
			<label for="r37" class="ident">b</label> == <span class="lit-number">0x0B</span>,
			<span class="lit-number">0x0E</span> &lt;= <label for="r37" class="ident">b</label> &amp;&amp; <label for="r37" class="ident">b</label> &lt;= <span class="lit-number">0x1A</span>,
			<span class="lit-number">0x1C</span> &lt;= <label for="r37" class="ident">b</label> &amp;&amp; <label for="r37" class="ident">b</label> &lt;= <span class="lit-number">0x1F</span>:
			<span class="keyword">return</span> <span class="lit-string">""</span>
		}
	}
	<span class="keyword">return</span> <span class="lit-string">"text/plain; charset=utf-8"</span>
</code></pre></div></div>

</div><pre id="footer">
<table><tr><td><img src="../../../png/go101-twitter.png"></td>
<td>The pages are generated with <a href="https://go101.org/article/tool-golds.html"><b>Golds</b></a> <i>v0.3.2-preview</i>. (GOOS=darwin GOARCH=amd64)
<b>Golds</b> is a <a href="https://go101.org">Go 101</a> project developed by <a href="https://tapirgames.com">Tapir Liu</a>.
PR and bug reports are welcome and can be submitted to <a href="https://github.com/go101/golds">the issue list</a>.
Please follow <a href="https://twitter.com/go100and1">@Go100and1</a> (reachable from the left QR code) to get the latest news of <b>Golds</b>.</td></tr></table></pre>